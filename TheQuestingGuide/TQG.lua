if not TQG then TQG={}end;TQG.Overview=ZO_Object:Subclass()local a="TheQuestingGuide"TQG.sceneNameQuestGuideOverview="QuestGuideOverview"TQG.Overview.minClassicLinks=1;TQG.Overview.maxClassicLinks=2;TQG.Overview.minDLCLinks=1;TQG.Overview.maxDLCLinks=2;local function b()return true end;local c="現在、日本語では操作できません"local e="アドオンは、現在日本語でサポートされていない手動でキュレートされたデータベースと一致するために、いくつかの完了したクエストを必要とします。多くのクエストを完了し、日本人ユーザー向けの翻訳を作成したい場合は、https：//esoui.c​​omで著者に直接メッセージを送信してください。ご不便をおかけして申し訳ございません。私たちはあなたの助けを借りて将来的にサポートを追加できます。"local f={mustChoose=false,title={text=c},mainText={text=e},buttons={[1]={keybind="DIALOG_NEGATIVE",text=SI_DIALOG_CANCEL,callback=function()return end}}}ZO_Dialogs_RegisterCustomDialog("TQG_JAPANESE_ERROR_DIALOGUE",f)function TQG:ToggleMenu()if GetCVar("language.2")=="jp"then ZO_Dialogs_ShowDialog("TQG_JAPANESE_ERROR_DIALOGUE")return end;if not b()then return end;if not TQG.MenuState then TQG.MenuState=0 end;if TQG.MenuHidden==nil then TQG.MenuHidden=true end;local g=TQG.MenuState;local h=TQG.MenuHidden;local i={[1]=TQG.sceneNameQuestGuideOverview,[2]=TQG.sceneNameQuestGuideClassic,[3]=TQG.sceneNameQuestGuideDLC,[4]=TQG.sceneNameQuestGuideGroup}if g==0 then g=1;h=false;TQGButtonsButton1.m_object:SetState(1)TQGButtonsButton1.m_object:SetLocked(true)SCENE_MANAGER:Show(i[1])elseif h==true then SCENE_MANAGER:Show(i[g])h=false elseif h==false then SCENE_MANAGER:Hide(i[g])h=true end;TQG.MenuState=g;TQG.MenuHidden=h end;function TQG:IsGuideHidden()local j={TQG.sceneNameQuestGuideOverview,TQG.sceneNameQuestGuideClassic,TQG.sceneNameQuestGuideDLC,TQG.sceneNameQuestGuideGroup}for k,l in ipairs(j)do if SCENE_MANAGER:IsShowing(l)then return false end end;return true end;function TQG.Overview:Initialize(m)TQG.BACKGROUND_FRAGMENT=ZO_FadeSceneFragment:New(TQG_SharedRightBackground)local n=TQG.sceneNameQuestGuideOverview;TQG_OVERVIEW_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabOverview)TQG_SCENE_OVERVIEW=ZO_Scene:New(n,SCENE_MANAGER)TQG_SCENE_OVERVIEW:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_OVERVIEW:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_OVERVIEW:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_OVERVIEW:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_OVERVIEW:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_OVERVIEW:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_OVERVIEW:AddFragment(TITLE_FRAGMENT)TQG_SCENE_OVERVIEW:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_OVERVIEW:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_OVERVIEW:AddFragment(TQG_OVERVIEW_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(n,TQG_SCENE_Overview)TQG_SCENE_OVERVIEW:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=1;TQG.MenuHidden=false;TQGButtonsButton2.m_object:SetState(0)TQGButtonsButton2.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)end;function TQG.Overview:New(m)TQG.Overview:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabOverview_ObjectiveLine",m,"Objective")local r,s,t,u,v,w,x=q.zoneInfoContainer:GetAnchor(0)local y,z,A,B,C,D,E=q.zoneInfoContainer:GetAnchor(1)q.zoneInfoContainer:ClearAnchors()q.zoneInfoContainer:SetAnchor(s,t,u,v,w)q.zoneInfoContainer:SetAnchor(z,A,B,v,100)q.currentProgressionLevel=#TQG.TopLevelOverview;q:InitializeCategoryList(m)q:RefreshList()local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.Overview:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"esoui/art/progression/progression_indexicon_world_down.dds","esoui/art/progression/progression_indexicon_world_up.dds","esoui/art/progression/progression_indexicon_world_over.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function J(K,m,I,L)local M=m:GetNamedChild("Text")end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelOverview[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)K.selectionFunction=J(K,m,I,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,J,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then self:RefreshDetails()if S.name~=TQG.ZoneLevelOverview[1][1].name then for k=TQG.Overview.minClassicLinks,TQG.Overview.maxClassicLinks do notesWithLinks[1][k]:SetHidden(true)end;for k=TQG.Overview.minDLCLinks,TQG.Overview.maxDLCLinks do notesWithLinks[2][k]:SetHidden(false)end end;if S.name~=TQG.ZoneLevelOverview[1][2].name then for k=TQG.Overview.minClassicLinks,TQG.Overview.maxClassicLinks do notesWithLinks[1][k]:SetHidden(false)end;for k=TQG.Overview.minDLCLinks,TQG.Overview.maxDLCLinks do notesWithLinks[2][k]:SetHidden(true)end end;if S.name==TQG.ZoneLevelOverview[1][3].name then for k=TQG.Overview.minClassicLinks,TQG.Overview.maxClassicLinks do notesWithLinks[1][k]:SetHidden(true)end;for k=TQG.Overview.minDLCLinks,TQG.Overview.maxDLCLinks do notesWithLinks[2][k]:SetHidden(true)end end end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local a1=TQG.ZoneLevelOverview[I][a0].name;local a2=TQG.ZoneLevelOverview[I][a0].id;local a3=a0;return a1,a2,a3 end;local function a4(I,a0,objectiveIndex)local a5=true;local a6=false;local a7=TQG.ObjectiveLevelOverview[I][a0][objectiveIndex].name;local a8=TQG.ObjectiveLevelOverview[I][a0][objectiveIndex].description;local a9=TQG.ObjectiveLevelOverview[I][a0][objectiveIndex].description;return a7,a8,a9,objectiveIndex,a5,a6 end;function TQG.Overview:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local aa={}for I=1,#TQG.TopLevelOverview do local ab=#TQG.ZoneLevelOverview[I]if self.currentProgressionLevel<I then break end;if ab>0 then local ac=self.navigationTree:AddNode("ZO_IconHeader",I)for ad=1,ab do local a1,a2,a3=Z(I,ad)local ae=true;local af={}local ag=#TQG.ObjectiveLevelOverview[I][ad]for objectiveIndex=1,ag do local a7,ah,ai,aj,ak,al=a4(I,ad,objectiveIndex)ae=ae and al;table.insert(af,{name=a7,openingText=ah,closingText=ai,order=aj,discovered=ak,completed=al})end;table.sort(af,ZO_CadwellSort)table.insert(aa,{name=a1,description=a2,order=a3,completed=ae,objectives=af,parent=ac})end end end;table.sort(aa,ZO_CadwellSort)for k=1,#aa do local am=aa[k]local ac=am.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",am,ac)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.Overview:RefreshDetails()local self=TQG_ALMANAC_OVERVIEW;self.objectiveLinePool:ReleaseAllObjects()local an=self.navigationTree:GetSelectedData()if not an or not an.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;self.titleText:SetText(zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,an.name))self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,an.description))local ao;for k=1,#an.objectives do local ap=an.objectives[k]local aq=self.objectiveLinePool:AcquireObject()if ap.discovered and not ap.completed then aq:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))elseif not ap.discovered then aq:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))else aq:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(false)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.closingText))end;if not ao then aq:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else aq:SetAnchor(TOPLEFT,ao,BOTTOMLEFT,0,15)end;ao=aq end end;function TQG.Overview:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabOverview_OnShown()TQG_ALMANAC_OVERVIEW:OnShown()end;function TQG_TabOverview_Initialize(m)TQG_ALMANAC_OVERVIEW=TQG.Overview:New(m)end;local function ar(as,at,au,av)local m=GetControl("TQG_TabOverviewZoneStepContainer")local aw="Click_MenuBar"local ax=200;local ay=28;local az=0;local aA=10;if not notesWithLinks then notesWithLinks={}notesWithLinks[1]={}notesWithLinks[2]={}notesWithLinks[3]={}end;notesWithLinks[as][#notesWithLinks[as]+1]=CreateControlFromVirtual(at,m,"ZO_DefaultButton")local aB=math.fmod(#notesWithLinks[as],3)if#notesWithLinks[as]>=2 and#notesWithLinks[as]<=3 then az=(#notesWithLinks[as]-1)*190 elseif#notesWithLinks[as]>=4 then if aB~=1 then if aB==0 then az=2*190 else az=(math.fmod(#notesWithLinks[as],3)-1)*190 end end;aA=(math.ceil(#notesWithLinks[as]/3)-1)*(33+aA)end;notesWithLinks[as][#notesWithLinks[as]]:SetAnchor(LEFT,m,LEFT,az,aA)notesWithLinks[as][#notesWithLinks[as]]:SetDimensions(ax,ay)notesWithLinks[as][#notesWithLinks[as]]:SetHandler("OnClicked",function()RequestOpenUnsafeURL(av)end)notesWithLinks[as][#notesWithLinks[as]]:SetText(au)end;DefaultValues={["en"]={},["de"]={},["fr"]={},["ru"]={},["ruMaps"]={}}local function aC(aD,aE)if aE~=a then return end;if not b()then return end;TQG.DLC:SetupPins()TQG.Group:SetupPins()ar(1,"TQGNoteLink1.1",TQG.BtnQuestMap,"https://en.uesp.net/wiki/Online:Story_Quests#Quest_Map")ar(1,"TQGNoteLink1.2",TQG.BtnCraglorn,"https://en.uesp.net/wiki/Online:Craglorn#Quest_Map")ar(2,"TQGNoteLink2.1",TQG.BtnImperialCity,"https://en.uesp.net/wiki/Online:Imperial_City#Quests")ar(2,"TQGNoteLink2.2",TQG.BtnOrsinium,"https://en.uesp.net/wiki/Online:Wrothgar#Quest_Map")EVENT_MANAGER:UnregisterForEvent("TheQuestingGuide",EVENT_ADD_ON_LOADED)end;EVENT_MANAGER:RegisterForEvent("TheQuestingGuide",EVENT_ADD_ON_LOADED,aC)local function aF()TQG:ToggleMenu()end;SLASH_COMMANDS["/tqg"]=aF;if not TQG then TQG={}end;TQG.Classic=ZO_Object:Subclass()TQG.sceneNameQuestGuideClassic="QuestGuideClassic"TQG.selectedClassicZoneId=nil;TQG.trackedClassicZoneId=nil;TQG.ConfirmContinueClassicToEndingQuests={mustChoose=false,title={text=GetString(TQG_CONFIRM_QUEST_TITLE)},mainText={text=GetString(TQG_CONFIRM_MAIN_TEXT)},buttons={[1]={keybind="DIALOG_PRIMARY",text=GetString(TQG_CONFIRM_QUEST_ZONE_STORY),callback=function()TQG:TrackNextActivity(TQG.selectedClassicZoneId,nil)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.Classic:UpdateZoneStoryButtons()end},[2]={keybind="DIALOG_SECONDARY",text=GetString(TQG_CONFIRM_QUEST_POI),callback=function()TQG:TrackNextActivity(TQG.selectedClassicZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.Classic:UpdateZoneStoryButtons()end}}}ZO_Dialogs_RegisterCustomDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY",TQG.ConfirmContinueClassicToEndingQuests)local function aG()local I=0;local a0=0;local aH=1;for k=1,#TQG.ZoneLevelClassic do while aH<=#TQG.ZoneLevelClassic[k]do if TQG.ZoneLevelClassic[k][aH].id==TQG.selectedClassicZoneId then I=k;a0=aH;break end;aH=aH+1 end;if I>0 then break else aH=1 end end;return I,a0 end;local function aI(I,a0)local aJ,aK;aJ,aK,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedClassicZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)local aL=aK-aJ>0;aJ,aK,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedClassicZoneId,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)local aM=aK-aJ==TQG.ZoneLevelClassic[I][a0].PreEndSideQuestCheck;return false,false end;local function aN(I,a0)local self=TQG_ALMANAC_CLASSIC;local an=self.navigationTree:GetSelectedData()if not an or not an.objectives then return end;local aO;if TQG.ObjectiveLevelClassic[I][a0][0]then aO=TQG.ObjectiveLevelClassic[I][a0][0].prologueQIds else aO=nil end;if not aO then return false,false end;for k=1,aO do if an.objectives[k].discovered==false then return true,false,k-1 elseif an.objectives[k].completed==false then return true,true,k-1 end end;return false,false end;function TQG:TrackNextActivity(aP,aQ)if aP then if ZO_ZoneStories_Shared.IsZoneCollectibleUnlocked(aP)then local aR=true;local aS=aQ;TrackNextActivityForZoneStory(aP,aS,aR)else local ad=GetZoneIndex(aP)local aT=GetCollectibleIdForZone(ad)local aU=ZO_COLLECTIBLE_DATA_MANAGER:GetCollectibleDataById(aT)local aV=aU:GetCategoryType()if aV==COLLECTIBLE_CATEGORY_TYPE_CHAPTER then ZO_ShowChapterUpgradePlatformScreen(MARKET_OPEN_OPERATION_ZONE_STORIES)else local aW=zo_strformat(SI_CROWN_STORE_SEARCH_FORMAT_STRING,aU:GetName())ShowMarketAndSearch(aW,MARKET_OPEN_OPERATION_ZONE_STORIES)end end end end;function TQG:GetPlayStoryButtonText(aP)if type(aP)=="number"then if not ZO_ZoneStories_Shared.IsZoneCollectibleUnlocked(aP)then return ZO_ZoneStories_Shared.GetZoneCollectibleUnlockText(aP)elseif ZO_ZoneStories_Manager.IsZoneComplete(aP)then return zo_strformat(SI_ZONE_STORY_ZONE_COMPLETE_ACTION)elseif ZO_ZoneStories_Manager.IsZoneCompletionTypeComplete(aP,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)or not CanZoneStoryContinueTrackingActivitiesForCompletionType(aP,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)then return zo_strformat(SI_ZONE_STORY_EXPLORE_ZONE_ACTION)elseif not IsZoneStoryStarted(aP)then return zo_strformat(SI_ZONE_STORY_START_STORY_ACTION)else return zo_strformat(SI_ZONE_STORY_CONTINUE_STORY_ACTION)end end;return zo_strformat(SI_ZONE_STORY_CONTINUE_STORY_ACTION)end;function TQG.Classic:PlayStory_OnClick()local I,a0;local aL,aM;local aX;I,a0=aG()if I<1 then return end;aL,aM=aI(I,a0)aX,prologueForClassicInProgress,objectiveIndex=aN(I,a0)if TQG.ZoneLevelClassic[I][a0].SideQuestCheck and aL and aM then ZO_Dialogs_ShowDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY")else TQG:TrackNextActivity(TQG.selectedClassicZoneId)ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateZoneStoryButtons()end end;function TQG.Classic:StopTracking_OnClick()ClearTrackedZoneStory()ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateZoneStoryButtons()end;function TQG.Classic:UpdateZoneStoryButtons(S)if S then for k=1,#TQG.TopLevelClassic do for aH=1,#TQG.ZoneLevelClassic[k]do if TQG.ZoneLevelClassic[k][aH].name==S.name then TQG.selectedClassicZoneId=TQG.ZoneLevelClassic[k][aH].id;break end end end end;local aP=TQG.selectedClassicZoneId;local aY;local aZ;if type(aP)=="string"then aY=false;aZ=false else aY=ZO_ZoneStories_Manager.GetZoneAvailability(aP)aZ=CanZoneStoryContinueTrackingActivities(aP)end;TQG.Classic.playStoryButton:SetEnabled(aY and aZ)TQG.Classic.playStoryButton:SetText(TQG:GetPlayStoryButtonText(aP))local a_=GetTrackedZoneStoryActivityInfo()TQG.Classic.stopTrackingButton:SetHidden(a_~=aP)end;function TQG.Classic:StoryButtonHook(b0)local b1=GetControl(b0)local b2=b1:GetNamedChild("ButtonContainer")TQG.Classic.playStoryButton=b2:GetNamedChild("PlayStoryButton")TQG.Classic.playStoryButton:SetClickSound(SOUNDS.ZONE_STORIES_TRACK_ACTIVITY)TQG.Classic.stopTrackingButton=b2:GetNamedChild("StopTrackingButton")end;function TQG.Classic:Initialize(m)local b3=TQG.sceneNameQuestGuideClassic;TQG_CLASSIC_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabClassic)TQG_SCENE_CLASSIC=ZO_Scene:New(b3,SCENE_MANAGER)TQG_SCENE_CLASSIC:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_CLASSIC:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_CLASSIC:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_CLASSIC:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_CLASSIC:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_CLASSIC:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_CLASSIC:AddFragment(TITLE_FRAGMENT)TQG_SCENE_CLASSIC:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_CLASSIC:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_CLASSIC:AddFragment(TQG_CLASSIC_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(b3,TQG_SCENE_Classic)TQG_SCENE_CLASSIC:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=2;TQG.MenuHidden=false;TQGButtonsButton1.m_object:SetState(0)TQGButtonsButton1.m_object:SetLocked(false)TQGButtonsButton3.m_object:SetState(0)TQGButtonsButton3.m_object:SetLocked(false)TQGButtonsButton4.m_object:SetState(0)TQGButtonsButton4.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)TQG.Classic:StoryButtonHook("TQG_TabClassic")end;function TQG.Classic:New(m)TQG.Classic:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabClassic_ObjectiveLine",m,"Objective")q.currentProgressionLevel=#TQG.TopLevelClassic;q:InitializeCategoryList(m)q:RefreshList()local function b4()q:RefreshList()end;local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_ADDED,b4)m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.Classic:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"esoui/art/campaign/campaignbrowser_indexicon_specialevents_down.dds","esoui\art/campaign/campaignbrowser_indexicon_specialevents_up.dds","esoui/art/campaign/campaignbrowser_indexicon_specialevents_over.dds"},[2]={"/esoui/art/charactercreate/charactercreate_aldmeriicon_down.dds","/esoui\art/charactercreate/charactercreate_aldmeriicon_up.dds","/esoui/art/charactercreate/charactercreate_aldmeriicon_over.dds"},[3]={"/esoui/art/charactercreate/charactercreate_daggerfallicon_down.dds","/esoui\art/charactercreate/charactercreate_daggerfallicon_up.dds","/esoui/art/charactercreate/charactercreate_daggerfallicon_over.dds"},[4]={"/esoui/art/charactercreate/charactercreate_ebonhearticon_down.dds","/esoui\art/charactercreate/charactercreate_ebonhearticon_up.dds","/esoui/art/charactercreate/charactercreate_ebonhearticon_over.dds"},[5]={"esoui/art/icons/progression_tabicon_fightersguild_down.dds","esoui\art/icons/progression_tabicon_fightersguild_up.dds","esoui/art/icons/progression_tabicon_fightersguild_over.dds"},[6]={"esoui/art/icons/progression_tabicon_magesguild_down.dds","esoui\art/icons/progression_tabicon_magesguild_up.dds","esoui/art/icons/progression_tabicon_magesguild_over.dds"},[7]={"esoui/art/treeicons/antiquities_tabicon_coldharbour_down.dds","esoui\art/treeicons/antiquities_tabicon_coldharbour_up.dds","esoui/art/treeicons/antiquities_tabicon_coldharbour_over.dds"},[8]={"esoui/art/treeicons/antiquities_tabicon_craglorn_down.dds","esoui\art/treeicons/antiquities_tabicon_craglorn_up.dds","esoui/art/treeicons/antiquities_tabicon_craglorn_over.dds"},[9]={"EsoUI/Art/Campaign/campaign_tabIcon_browser_down.dds","EsoUI\Art/Campaign/campaign_tabIcon_browser_up.dds","EsoUI/Art/Campaign/campaign_tabIcon_browser_over.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function J(K,m,I,L)local M=m:GetNamedChild("Text")end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelClassic[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)K.selectionFunction=J(K,m,I,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,J,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then TQG.Classic:UpdateZoneStoryButtons(S)self:RefreshDetails()end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local a7=TQG.ZoneLevelClassic[I][a0].name;local b5=TQG.ZoneLevelClassic[I][a0].id;local a2=""if type(a7)=="number"or a7==""then a7=TQG.ZoneLevelClassic[I][a0].name;a7="("..string.format("%.2f",a7)..")"local b6=GetCVar("language.2")if b6=="de"or b6=="fr"or b6=="ru"then a7=string.gsub(a7,"%.",",",1)end;local a1=GetZoneNameById(b5)TQG.ZoneLevelClassic[I][a0].name=a7 .." "..a1 end;local a1=TQG.ZoneLevelClassic[I][a0].name;if type(b5)=="string"then a2=b5 else a2=GetZoneDescriptionById(b5)end;local a3=a0;return b5,a1,a2,a3 end;local function b7(I,a0,objectiveIndex)local b6=GetCVar("language.2")if b6~="de"and b6~="fr"and b6~="ru"then b6="en"end;local a6=false;local aj=objectiveIndex;local a7,a8,a9,a5;local b8,b9,ba,bb;local aP=TQG.ZoneLevelClassic[I][a0].id;local bc=false;local bd=false;local be=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideDetails;local bf=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].internalId;if be then local overrideName=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideQName or nil;b8=bf;a7=GetQuestName(b8)if overrideName then a7=overrideName end else local bg=TQG.ObjectiveLevelClassic[I][a0][1].prologueQIds;if bg and objectiveIndex>=bg then aj=aj+bg-1;objectiveIndex=objectiveIndex-(bg-1)end;a7=GetZoneStoryActivityNameByActivityIndex(aP,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS,objectiveIndex)objectiveIndex=aj end;if not b8 then for k,bh in ipairs(TQG.MultiQuestIds[1])do local bi=GetCompletedQuestInfo(bh)or""if bi==a7 then local b5=4704;b8=b5;bb=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideDescription;if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b8)end;if b9==""then b9=nil end;bc=true;break end end end;if not b8 then for k=3,10 do for aH,bj in ipairs(TQG.MultiQuestIds[k])do local bi=GetCompletedQuestInfo(bj)or""if bi==a7 then b8=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].internalId;bb=LibUespQuestData:GetUespQuestBackgroundText(b8)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=nil,"",0 end;if b9==""then b9=nil end;bd=true;break end end end end;if not b8 then for k,bk in pairs(LibUespQuestData.quests)do local b5=tonumber(bk.internalId)local bi=GetCompletedQuestInfo(b5)if bi==""or bi==nil then bi=GetCompletedQuestInfo(b5)or""end;if LibUespQuestData:GetUespQuestName(b5)==a7 and not overrideName then b8=b5;bb=LibUespQuestData:GetUespQuestBackgroundText(b8)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b8)end;if b9==""then b9=nil end;break elseif bi==a7 then b8=b5;bb=LibUespQuestData:GetUespQuestBackgroundText(b8)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9=LibUespQuestData:GetUespQuestLocationInfo(b8)end;if b9==""then b9=nil end;if I==2 and a0==2 then end;break end end;if I==2 and a0==2 then end else bb=LibUespQuestData:GetUespQuestBackgroundText(b8)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b8)end;if b9==""then b9=nil end end;if type(aP)=="number"then a8=b9 or GetZoneNameById(aP)else a8=b9 end;if GetCompletedQuestInfo(b8)==""and not bc and not bd then a6=false;for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==a7 then a5=true;_,a8=GetJournalQuestInfo(k)break else a5=false end end;a9=""else a6=true;a5=true;a8=""a9=bb end;local function bl(bm,bn)if a7==LibUespQuestData:GetUespQuestName(bn)then bm=string.gsub(bm," u2026.","...")else bm=string.gsub(bm," u2026","...")end;return bm end;if bb~=""and bb then if a9==bb then a9=bl(a9,4296)a9=bl(a9,-1)a9=string.gsub(a9,"u2014","—")elseif a8==bb then a8=bl(a8,4296)a8=bl(a8,-1)a8=string.gsub(a8,"u2014","—")end end;local bo=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideZone;if a8==nil or a8==""or bo then a8=bo;if a8==nil or a8==""then a8=GetString(TQG_DEFAULT_QUEST_INCOMPLETE_STRING)end end;if a9==nil or a9==""then a9=GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING)end;local bp=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].optional or false;return a7,a8,a9,aj,a5,a6,bp end;function TQG.Classic:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local aa={}for I=1,#TQG.TopLevelClassic do local ab=#TQG.ZoneLevelClassic[I]if self.currentProgressionLevel<I then break end;if ab>0 then local ac=self.navigationTree:AddNode("ZO_IconHeader",I)for ad=1,ab do local aP,a1,a2,a3=Z(I,ad)local bq=0;local ae=true;local af={}local aJ,aK,br,bs;if type(aP)=="number"then aJ,aK,br,bs=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(aP,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)elseif type(aP)=="string"then aJ,aK,br,bs=0,0,0,0 end;local ag=br;local bt=false;if bs>0 then ag=ag+1;bt=true end;if ag==0 then ag=#TQG.ObjectiveLevelClassic[I][ad]end;local bu=1;if ag~=#TQG.ObjectiveLevelClassic[I][ad]then if TQG.ObjectiveLevelClassic[I][ad][0]then bu=0;local bg=TQG.ObjectiveLevelClassic[I][ad][0].prologueQIds;if bg and bg>1 then ag=ag+bg-1 end elseif TQG.ObjectiveLevelClassic[I][ad][ag+1].overrideDetails then ag=ag+#TQG.ObjectiveLevelClassic[I][ad]-ag end end;for objectiveIndex=bu,ag do local a7,ah,ai,aj,ak,al,bv;if objectiveIndex==ag and bt==true then a7="TBC"ah,ai=GetErrorString(bs)aj=objectiveIndex;ak=false;al=false;bv=false else a7,ah,ai,aj,ak,al,bv=b7(I,ad,objectiveIndex,aJ)ae=ae and(al or bv)if al then bq=bq+1 end end;table.insert(af,{name=a7,openingText=ah,closingText=ai,order=aj,discovered=ak,completed=al})end;table.sort(af,ZO_CadwellSort)table.insert(aa,{name=a1,description=a2,order=a3,completed=ae and bq>=1,objectives=af,parent=ac})end end end;table.sort(aa,ZO_CadwellSort)for k=1,#aa do local am=aa[k]local ac=am.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",am,ac)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.Classic:RefreshDetails()local self=TQG_ALMANAC_CLASSIC;self.objectiveLinePool:ReleaseAllObjects()local an=self.navigationTree:GetSelectedData()if not an or not an.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;self.titleText:SetText(zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,an.name))self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,an.description))local ao;for k=1,#an.objectives do local ap=an.objectives[k]local aq=self.objectiveLinePool:AcquireObject()if ap.name=="TBC"then aq:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(ap.openingText)elseif ap.discovered and not ap.completed then aq:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))elseif not ap.discovered then aq:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))else aq:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(false)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.closingText))end;if not ao then aq:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else aq:SetAnchor(TOPLEFT,ao,BOTTOMLEFT,0,15)end;ao=aq end end;function TQG.Classic:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabClassic_OnShown()TQG_ALMANAC_CLASSIC:OnShown()end;function TQG_TabClassic_Initialize(m)TQG_ALMANAC_CLASSIC=TQG.Classic:New(m)end;if not TQG then TQG={}end;TQG.DLC=ZO_Object:Subclass()TQG.sceneNameQuestGuideDLC="QuestGuideDLC"TQG.selectedDLCZoneId=nil;TQG.trackedDLCPrologueQuestId=nil;TQG.ConfirmContinueDLCToEndingQuests={mustChoose=false,title={text=GetString(TQG_CONFIRM_QUEST_TITLE)},mainText={text=GetString(TQG_CONFIRM_MAIN_TEXT)},buttons={[1]={keybind="DIALOG_PRIMARY",text=GetString(TQG_CONFIRM_QUEST_ZONE_STORY),callback=function()TQG:TrackNextActivity(TQG.selectedDLCZoneId,nil)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.DLC:UpdateStoryButtons()end},[2]={keybind="DIALOG_SECONDARY",text=GetString(TQG_CONFIRM_QUEST_POI),callback=function()TQG:TrackNextActivity(TQG.selectedDLCZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.DLC:UpdateStoryButtons()end}}}ZO_Dialogs_RegisterCustomDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY",TQG.ConfirmContinueDLCToEndingQuests)local function bw()local I=0;local a0=0;local aH=1;for k=1,#TQG.ZoneLevelDLC do while aH<=#TQG.ZoneLevelDLC[k]do if TQG.ZoneLevelDLC[k][aH].id==TQG.selectedDLCZoneId then I=k;a0=aH;break end;aH=aH+1 end;if I>0 then break else aH=1 end end;return I,a0 end;local function bx(I,a0)local aJ,aK;aJ,aK,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedDLCZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)local aL=aK-aJ>0;aJ,aK,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedDLCZoneId,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)local aM=aK-aJ==TQG.ZoneLevelDLC[I][a0].PreEndSideQuestCheck;return false,false end;local function by(I,a0)local self=TQG_ALMANAC_DLC;local an=self.navigationTree:GetSelectedData()if not an or not an.objectives then return end;local aO;if TQG.ObjectiveLevelDLC[I][a0][0]then aO=TQG.ObjectiveLevelDLC[I][a0][0].prologueQIds else aO=nil end;if not aO then return false,false end;for k=1,aO do if an.objectives[k].discovered==false then return true,false,k-1 elseif an.objectives[k].completed==false then return true,true,k-1 end end;return false,false end;local b6=GetCVar("language.2")if b6~="de"and b6~="fr"then b6="en"end;local bz="TQG_QuestsDLC"local bA={}local function bB()bA={[5935]={[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.5559,0.5307,0.012,questId=5935,text=TQG.DLCQuestIdToTooltip[5935]}},[TQG.MapIdToLangName[33]]={{0.465429,0.154768,0.05,questId=5935,text=TQG.DLCQuestIdToTooltip[5935]}}},[6023]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.567,0.918,0.012,questId=6023,text=TQG.DLCQuestIdToTooltip[6023],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.231,0.5038,0.05,questId=6023,text=TQG.DLCQuestIdToTooltip[6023],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.2746,0.7435,0.012,questId=6023,text=TQG.DLCQuestIdToTooltip[6023],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.479,0.3914,0.05,questId=6023,text=TQG.DLCQuestIdToTooltip[6023],allianceId=3}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.85845,0.330827,0.012,questId=6023,text=TQG.DLCQuestIdToTooltip[6023],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.491956,0.434811,0.05,questId=6023,text=TQG.DLCQuestIdToTooltip[6023],allianceId=2}}},[6097]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.567,0.918,0.012,questId=6097,text=TQG.DLCQuestIdToTooltip[6097],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.231,0.5038,0.05,questId=6097,text=TQG.DLCQuestIdToTooltip[6097],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.85845,0.330827,0.012,questId=6097,text=TQG.DLCQuestIdToTooltip[6097],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.491956,0.434811,0.05,questId=6097,text=TQG.DLCQuestIdToTooltip[6097],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.2746,0.7435,0.012,questId=6097,text=TQG.DLCQuestIdToTooltip[6097],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.479,0.3914,0.05,questId=6097,text=TQG.DLCQuestIdToTooltip[6097],allianceId=3}}},[6226]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5641,0.4696,0.012,questId=6226,text=TQG.DLCQuestIdToTooltip[6226],allianceId=1}},[TQG.MapIdToLangName[445]]={{0.49595,0.36798,0.05,questId=6226,text=TQG.DLCQuestIdToTooltip[6226],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.5688,0.5339,0.012,questId=6226,text=TQG.DLCQuestIdToTooltip[6226],allianceId=2}},[TQG.MapIdToLangName[205]]={{0.58299,0.76898,0.05,questId=6226,text=TQG.DLCQuestIdToTooltip[6226],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.545,0.534,0.012,questId=6226,text=TQG.DLCQuestIdToTooltip[6226],allianceId=3}},[TQG.MapIdToLangName[33]]={{0.4221,0.16459,0.05,questId=6226,text=TQG.DLCQuestIdToTooltip[6226],allianceId=3}}},[6242]={[GetMapNameByIndex(GetMapIndexByZoneId(117))]={{0.5076,0.2318,0.012,questId=6242,text=TQG.DLCQuestIdToTooltip[6242]}},[TQG.MapIdToLangName[217]]={{0.8422,0.2390,0.05,questId=6242,text=TQG.DLCQuestIdToTooltip[6242]}}},[6299]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.6411,0.8744,0.012,questId=6299,text=TQG.DLCQuestIdToTooltip[6299],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.5971,0.2883,0.05,questId=6299,text=TQG.DLCQuestIdToTooltip[6299],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.9120,0.3982,0.012,questId=6299,text=TQG.DLCQuestIdToTooltip[6299],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.7593,0.7710,0.05,questId=6299,text=TQG.DLCQuestIdToTooltip[6299],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.3422,0.7472,0.012,questId=6299,text=TQG.DLCQuestIdToTooltip[6299],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.8074,0.40887,0.05,questId=6299,text=TQG.DLCQuestIdToTooltip[6299],allianceId=3}}},[6306]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5942,0.1537,0.012,questId=6306,text=TQG.DLCQuestIdToTooltip[6306]}}},[6395]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.63695,0.93553,0.012,questId=6395,text=TQG.DLCQuestIdToTooltip[6395],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.5766,0.5903,0.05,questId=6395,text=TQG.DLCQuestIdToTooltip[6395],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.90468,0.38861,0.012,questId=6395,text=TQG.DLCQuestIdToTooltip[6395],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.7226,0.7231,0.05,questId=6395,text=TQG.DLCQuestIdToTooltip[6395],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.32298,0.80255,0.012,questId=6395,text=TQG.DLCQuestIdToTooltip[6395],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.7141,0.6731,0.05,questId=6395,text=TQG.DLCQuestIdToTooltip[6395],allianceId=3}}},[6398]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.63695,0.93553,0.012,questId=6398,text=TQG.DLCQuestIdToTooltip[6398],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.5766,0.5903,0.05,questId=6398,text=TQG.DLCQuestIdToTooltip[6398],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.90468,0.38861,0.012,questId=6398,text=TQG.DLCQuestIdToTooltip[6398],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.7226,0.7231,0.05,questId=6398,text=TQG.DLCQuestIdToTooltip[6398],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.32298,0.80255,0.012,questId=6398,text=TQG.DLCQuestIdToTooltip[6398],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.7141,0.6731,0.05,questId=6398,text=TQG.DLCQuestIdToTooltip[6398],allianceId=3}}}}end;function TQG.DLC:SetupPins()bB()local function bC(bD)local bE=GetMapName()local b8=TQG.trackedDLCPrologueQuestId;if bA[b8]==nil then return end;if bA[b8][bE]==nil then return end;local bF=bA[b8][bE]for _,bG in ipairs(bF)do bD:CreatePin(_G[bz],bG,bG[1],bG[2])end end;local bH=bC;local bI=nil;pinLayoutData={showsPinAndArea=true,level=10,minSize=100,texture="EsoUI/Art/MapPins/MapAutoNavigationPing.dds",isAnimated=true,framesWide=32,framesHigh=1,framesPerSecond=32}local bJ={creator=function(bK)local bL,au;local bE=GetMapName()local b8=TQG.trackedDLCPrologueQuestId;if bA[b8]==nil then return end;if bA[b8][bE]==nil then return end;local bF=bA[b8][bE]for _,bG in ipairs(bF)do if bG[4]==bK.m_PinTag[4]then bL=GetQuestName(bG.questId)au=bG.text;break end end;InformationTooltip:AddLine(bL,"ZoFontGameOutline",ZO_SELECTED_TEXT:UnpackRGB())ZO_Tooltip_AddDivider(InformationTooltip)InformationTooltip:AddLine(au,"",ZO_HIGHLIGHT_TEXT:UnpackRGB())end,tooltip=1}ZO_WorldMap_AddCustomPin(bz,bH,bI,pinLayoutData,bJ)ZO_WorldMap_SetCustomPinEnabled(_G[bz],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[bz])end;local function bM(bN,bO,bP,b9)local bE=GetMapName()local b8=TQG.trackedDLCPrologueQuestId;if pindData[b8]==nil or bA[b8][bE]==nil then return end;local bF=bA[b8][bE]for _,bG in ipairs(bF)do if bP==LibUespQuestData:GetUespQuestName(bG.questId)then ZO_WorldMap_SetCustomPinEnabled(_G[bz],false)ZO_WorldMap_RefreshCustomPinsOfType(_G[bz])EVENT_MANAGER:UnregisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED)break end end end;function TQG.DLC:PlayStory_OnClick()local I,a0;local aL,aM;local bQ;I,a0=bw()if I<1 then return end;aL,aM=bx(I,a0)bQ,prologueForDLCInProgress,objectiveIndex=by(I,a0)if TQG.ZoneLevelDLC[I][a0].SideQuestCheck and aL and aM then ZO_Dialogs_ShowDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY")elseif bQ and objectiveIndex then local b8=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].internalId;local bz=bz;local bR=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].mapIndex;local bE=GetMapNameByIndex(bR)TQG.trackedDLCPrologueQuestId=b8;if prologueForDLCInProgress then for k=1,GetNumJournalQuests()do local bP;if TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideQName then bP=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideQName elseif LibUespQuestData:GetUespQuestName(b8)then bP=LibUespQuestData:GetUespQuestName(b8)end;if GetJournalQuestName(k)==bP then local bS=k;ZO_WorldMap_ShowQuestOnMap(bS)return end end end;if bA[b8]==nil then return end;if bA[b8][bE]==nil then return end;local bF=bA[b8][bE]local bT,bU;for _,bG in ipairs(bF)do if bG.questId==b8 then bT=bG[1]bU=bG[2]break end end;ZO_WorldMap_SetCustomPinEnabled(_G[bz],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[bz])ZO_WorldMap_ShowWorldMap()zo_callLater(function()ZO_WorldMap_SetMapByIndex(bR)end,1000)zo_callLater(function()ZO_WorldMap_PanToNormalizedPosition(bT,bU)end,1750)EVENT_MANAGER:RegisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED,bM)else TQG:TrackNextActivity(TQG.selectedDLCZoneId)ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateStoryButtons()end end;function TQG.DLC:StopTracking_OnClick()ClearTrackedZoneStory()ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateStoryButtons()end;function TQG.DLC:OnQuestAcceptClicked(self)d(DLC_BOOK_KEYBOARD.navigationTree:GetSelectedData())end;function TQG.DLC:UpdateStoryButtons(S)local bV=false;if S then for k=1,#TQG.TopLevelDLC do for aH=1,#TQG.ZoneLevelDLC[k]do if TQG.ZoneLevelDLC[k][aH].name==S.name then TQG.selectedDLCZoneId=TQG.ZoneLevelDLC[k][aH].id;bV=TQG.ZoneLevelDLC[k][aH].isDungeonDLC;break end end end end;local aP=TQG.selectedDLCZoneId;local aY;local aZ;if type(aP)=="string"then aY=false;aZ=false else aY=ZO_ZoneStories_Manager.GetZoneAvailability(aP)aZ=CanZoneStoryContinueTrackingActivities(aP)end;TQG.DLC.playStoryButton:SetEnabled(aY and aZ)TQG.DLC.playStoryButton:SetText(TQG:GetPlayStoryButtonText(aP))TQG.DLC.playStoryButton:SetHidden(bV)local a_=GetTrackedZoneStoryActivityInfo()TQG.DLC.stopTrackingButton:SetHidden(a_~=aP)local bW;local bX;local bY;if type(aP)=="number"then bW=GetCollectibleIdForZone(GetZoneIndex(aP))bX=not IsCollectibleUnlocked(bW)bY=IsCollectibleActive(bW)else bW=0;bX=true;bY=false end;TQG.DLC.dungeonQuestAcceptButton:SetHidden(true)local bZ=bY and SI_DLC_BOOK_ACTION_QUEST_ACCEPTED or SI_DLC_BOOK_ACTION_ACCEPT_QUEST;TQG.DLC.dungeonQuestAcceptButton:SetText(GetString(bZ))TQG.DLC.dungeonQuestAcceptButton:SetEnabled(not(bX or bY))end;function TQG.DLC:StoryButtonHooks(b0)local b1=GetControl(b0)local b2=b1:GetNamedChild("ButtonContainer")TQG.DLC.playStoryButton=b2:GetNamedChild("PlayStoryButton")TQG.DLC.playStoryButton:SetClickSound(SOUNDS.ZONE_STORIES_TRACK_ACTIVITY)TQG.DLC.stopTrackingButton=b2:GetNamedChild("StopTrackingButton")TQG.DLC.dungeonQuestAcceptButton=b2:GetNamedChild("QuestAccept")end;function TQG.DLC:Initialize(m)local b_=TQG.sceneNameQuestGuideDLC;TQG_DLC_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabDLC)TQG_SCENE_DLC=ZO_Scene:New(b_,SCENE_MANAGER)TQG_SCENE_DLC:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_DLC:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_DLC:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_DLC:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_DLC:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_DLC:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_DLC:AddFragment(TITLE_FRAGMENT)TQG_SCENE_DLC:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_DLC:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_DLC:AddFragment(TQG_DLC_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(b_,TQG_SCENE_DLC)TQG_SCENE_DLC:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=3;TQG.MenuHidden=false;TQGButtonsButton1.m_object:SetState(0)TQGButtonsButton1.m_object:SetLocked(false)TQGButtonsButton2.m_object:SetState(0)TQGButtonsButton2.m_object:SetLocked(false)TQGButtonsButton4.m_object:SetState(0)TQGButtonsButton4.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)TQG.DLC:StoryButtonHooks("TQG_TabDLC")end;function TQG.DLC:New(m)TQG.DLC:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabDLC_ObjectiveLine",m,"Objective")q.currentProgressionLevel=#TQG.TopLevelDLC;q:InitializeCategoryList(m)q:RefreshList()local function b4()q:RefreshList()end;local function c0(bN,c1,bO,bP,ad,ba,b8)q:RefreshList()end;local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_ADDED,b4)m:RegisterForEvent(EVENT_QUEST_REMOVED,c0)m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.DLC:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"esoui/art/treeicons/store_indexicon_dlc_down.dds","esoui\art/treeicons/store_indexicon_dlc_up.dds","esoui/art/treeicons/store_indexicon_dlc_over.dds"},[2]={"esoui/art/icons/progression_tabicon_daedricconjuration_down.dds","esoui\art/icons/progression_tabicon_daedricconjuration_up.dds","esoui/art/icons/progression_tabicon_daedricconjuration_over.dds"},[3]={"/esoui/art/treeicons/tutorial_idexicon_murkmire_down.dds","/esoui\art/treeicons/tutorial_idexicon_murkmire_up.dds","/esoui/art/treeicons/tutorial_idexicon_murkmire_over.dds"},[4]={"esoui/art/icons/progression_tabicon_dragonaspect_down.dds","esoui\art/icons/progression_tabicon_dragonaspect_up.dds","esoui/art/icons/progression_tabicon_dragonaspect_over.dds"},[5]={"esoui/art/icons/progression_tabicon_darkmagic_down.dds","esoui\art/icons/progression_tabicon_darkmagic_up.dds","esoui/art/icons/progression_tabicon_darkmagic_over.dds"},[6]={"esoui/art/icons/heraldrycrests_daedra_mehronesdagon_01.dds","esoui\art\icons\heraldrycrests_daedra_mehronesdagon_01.dds","esoui/art/icons/heraldrycrests_daedra_mehronesdagon_01.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelDLC[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,nil,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then TQG.DLC:UpdateStoryButtons(S)self:RefreshDetails()end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local a7=TQG.ZoneLevelDLC[I][a0].name;local b5=TQG.ZoneLevelDLC[I][a0].id;local a2=""if type(a7)=="number"or a7==""then a7=TQG.ZoneLevelDLC[I][a0].name;a7="("..string.format("%.2f",a7)..")"local b6=GetCVar("language.2")if b6=="de"or b6=="fr"or b6=="ru"then a7=string.gsub(a7,"%.",",",1)end;local a1=GetZoneNameById(b5)TQG.ZoneLevelDLC[I][a0].name=a7 .." "..a1 end;local a1=TQG.ZoneLevelDLC[I][a0].name;if type(b5)=="string"then a2=b5 else a2=GetZoneDescriptionById(b5)end;local a3=a0;return b5,a1,a2,a3 end;local function b7(I,a0,objectiveIndex,aJ)local b6=GetCVar("language.2")if b6~="de"and b6~="fr"and b6~="ru"then b6="en"end;local a6=false;local aj=objectiveIndex;local a7,a8,a9,a5;local b8,b9,ba,bb;local aP=TQG.ZoneLevelDLC[I][a0].id;local c2=false;if TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideDetails then local overrideName=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideQName or nil;b8=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].internalId;a7=GetQuestName(b8)if overrideName then a7=overrideName end else local bg=TQG.ObjectiveLevelDLC[I][a0][1].prologueQIds;if bg and objectiveIndex>=bg then aj=aj+bg-1;objectiveIndex=objectiveIndex-(bg-1)end;a7=GetZoneStoryActivityNameByActivityIndex(aP,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS,objectiveIndex)objectiveIndex=aj end;if not b8 then for k,c3 in ipairs(TQG.MultiQuestIds[2])do local bi=GetCompletedQuestInfo(c3)or""if bi==a7 then local b5=5602;b8=b5;bb=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideDescription;if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b5)end;if b9==""then b9=nil end;c2=true;break end end end;if not b8 then for k,bk in pairs(LibUespQuestData.quests)do local b5=tonumber(bk.internalId)local bi=""bi=GetCompletedQuestInfo(b5)if bi==""or bi==nil then bi=GetCompletedQuestInfo(b5)or""end;if LibUespQuestData:GetUespQuestName(b5)==a7 and not overrideName then b8=b5;bb=LibUespQuestData:GetUespQuestBackgroundText(b5)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b5)end;if b9==""then b9=nil end;break elseif bi==a7 then b8=b5;bb=LibUespQuestData:GetUespQuestBackgroundText(b5)local b9=""if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9=LibUespQuestData:GetUespQuestLocationInfo(b5)end;if b9==""then b9=nil end;break end end elseif not c2 then bb=LibUespQuestData:GetUespQuestBackgroundText(b8)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b8)end;if b9==""then b9=nil end end;if type(aP)=="number"then a8=b9 or GetZoneNameById(aP)else a8=b9 end;if GetCompletedQuestInfo(b8)==""and not c2 then a6=false;for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==a7 then a5=true;_,a8=GetJournalQuestInfo(k)break else a5=false end end;a9=""else a6=true;a5=true;a8=""a9=bb end;local function bl(bm,bn)if a7==LibUespQuestData:GetUespQuestName(bn)then bm=string.gsub(bm," u2026.","...")else bm=string.gsub(bm," u2026","...")end;return bm end;if bb~=""and bb then if a9==bb then a9=bl(a9,4296)a9=bl(a9,-1)a9=string.gsub(a9,"u2014","—")elseif a8==bb then a8=bl(a8,4296)a8=bl(a8,-1)a8=string.gsub(a8,"u2014","—")end end;local bo=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideZone;if a8==nil or a8==""or bo then a8=bo;if a8==nil or a8==""then a8=GetString(TQG_DEFAULT_QUEST_INCOMPLETE_STRING)end end;if a9==nil or a9==""then a9=GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING)end;local bp=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].optional or false;return a7,a8,a9,aj,a5,a6,bp end;function TQG.DLC:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local aa={}for I=1,#TQG.TopLevelDLC do local ab=#TQG.ZoneLevelDLC[I]if self.currentProgressionLevel<I then break end;if ab>0 then local ac=self.navigationTree:AddNode("ZO_IconHeader",I)for ad=1,ab do local aP,a1,a2,a3=Z(I,ad)local bq=0;local ae=true;local af={}local aJ,aK,br,bs;if type(aP)=="number"then aJ,aK,br,bs=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(aP,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)elseif type(aP)=="string"then aJ,aK,br,bs=0,0,0,0 end;local ag=br;local bt=false;if bs>0 then ag=ag+1;bt=true end;if ag==0 then ag=#TQG.ObjectiveLevelDLC[I][ad]end;local bu=1;if ag~=#TQG.ObjectiveLevelDLC[I][ad]then if TQG.ObjectiveLevelDLC[I][ad][0]then bu=0;local bg=TQG.ObjectiveLevelDLC[I][ad][0].prologueQIds;if bg and bg>1 then ag=ag+bg-1 end elseif TQG.ObjectiveLevelDLC[I][ad][ag+1].overrideDetails then ag=ag+#TQG.ObjectiveLevelDLC[I][ad]-ag end end;for objectiveIndex=bu,ag do local a7,ah,ai,aj,ak,al,bv;if objectiveIndex==ag and bt==true then a7="TBC"ah,ai=GetErrorString(bs)aj=objectiveIndex;ak=false;al=false;bv=false else a7,ah,ai,aj,ak,al,bv=b7(I,ad,objectiveIndex,aJ)ae=ae and(al or bv)if al then bq=bq+1 end end;table.insert(af,{name=a7,openingText=ah,closingText=ai,order=aj,discovered=ak,completed=al})end;table.sort(af,ZO_CadwellSort)table.insert(aa,{name=a1,description=a2,order=a3,completed=ae and bq>=1,objectives=af,parent=ac})end end end;table.sort(aa,ZO_CadwellSort)for k=1,#aa do local am=aa[k]local ac=am.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",am,ac)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.DLC:RefreshDetails()local self=TQG_ALMANAC_DLC;self.objectiveLinePool:ReleaseAllObjects()local an=self.navigationTree:GetSelectedData()if not an or not an.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;self.titleText:SetText(zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,an.name))self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,an.description))local ao;for k=1,#an.objectives do local ap=an.objectives[k]local aq=self.objectiveLinePool:AcquireObject()if ap.name=="TBC"then aq:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(ap.openingText)elseif ap.discovered and not ap.completed then aq:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))elseif not ap.discovered then aq:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))else aq:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(false)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.closingText))end;if not ao then aq:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else aq:SetAnchor(TOPLEFT,ao,BOTTOMLEFT,0,15)end;ao=aq end end;function TQG.DLC:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabDLC_OnShown()TQG_ALMANAC_DLC:OnShown()end;function TQG_TabDLC_Initialize(m)TQG_ALMANAC_DLC=TQG.DLC:New(m)end;if not TQG then TQG={}end;TQG.Group=ZO_Object:Subclass()TQG.sceneNameQuestGuideGroup="QuestGuideGroup"TQG.selectedGroupZoneId=nil;TQG.trackedGroupQuestId=nil;TQG.trackedGroupObjectiveIndex=nil;function TQG.ButtonSetup(m)local aw="Click_MenuBar"local c4={categoryName=TQG.OverviewTabName,descriptor="The Questing Guide: Overview",normal="esoui/art/progression/progression_indexicon_world_up.dds",pressed="esoui/art/progression/progression_indexicon_world_down.dds",highlight="esoui/art/progression/progression_indexicon_world_over.dds",callback=function(c5)PlaySound(aw)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideOverview)end}local c6={categoryName=TQG.ClassicTabName,descriptor="The Questing Guide: Classic",normal="esoui/art/campaign/campaignbrowser_indexicon_specialevents_up.dds",pressed="esoui/art/campaign/campaignbrowser_indexicon_specialevents_down.dds",highlight="esoui/art/campaign/campaignbrowser_indexicon_specialevents_over.dds",callback=function(c5)PlaySound(aw)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideClassic)end}local c7={categoryName=TQG.DLCTabName,descriptor="The Questing Guide: DLC",normal="esoui/art/treeicons/store_indexicon_dlc_up.dds",pressed="esoui/art/treeicons/store_indexicon_dlc_down.dds",highlight="esoui/art/treeicons/store_indexicon_dlc_over.dds",callback=function(c5)PlaySound(aw)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideDLC)end}local c8={categoryName=TQG.GroupTabName,descriptor="The Questing Guide: Group",normal="esoui/art/icons/achievements_indexicon_dungeons_up.dds",pressed="esoui/art/icons/achievements_indexicon_dungeons_down.dds",highlight="esoui/art/icons/achievements_indexicon_dungeons_over.dds",callback=function(c5)PlaySound(aw)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideGroup)end}local c9=CreateControlFromVirtual("TQGButtons",TQG_SharedRightBackground,"ZO_LabelButtonBar")c9:SetAnchor(TOPRIGHT,TQG_SharedRightBackground,TOPRIGHT,-450,1)local ca={buttonPadding=16,normalSize=51,downSize=64,animationDuration=DEFAULT_SCENE_TRANSITION_TIME,buttonTemplate="ZO_MenuBarTooltipButton"}ZO_MenuBar_SetData(c9,ca)local cb=ZO_MenuBar_AddButton(c9,c4)local cc=ZO_MenuBar_AddButton(c9,c6)local cd=ZO_MenuBar_AddButton(c9,c7)local ce=ZO_MenuBar_AddButton(c9,c8)end;local function cf()local I=0;local a0=0;local aH=1;for k=1,#TQG.ZoneLevelGroup do while aH<=#TQG.ZoneLevelGroup[k]do if TQG.ZoneLevelGroup[k][aH].id==TQG.selectedGroupZoneId then I=k;a0=aH;break end;aH=aH+1 end;if I>0 then break else aH=1 end end;return I,a0 end;local function cg(I,a0)local aJ,aK;aJ,aK,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedGroupZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)local aL=aK-aJ>0;aJ,aK,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedGroupZoneId,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)local aM=aK-aJ==TQG.ZoneLevelGroup[I][a0].PreEndSideQuestCheck;return false,false end;local function ch(I,a0)local self=TQG_ALMANAC_GROUP;local an=self.navigationTree:GetSelectedData()if not an or not an.objectives then return end;local ci=#TQG.ObjectiveLevelGroup[I][a0]if not ci then return false,false end;for k=1,ci do if an.objectives[k].discovered==false then return true,false elseif an.objectives[k].completed==false then return true,true end end;return false,false end;local b6=GetCVar("language.2")if b6~="de"and b6~="fr"then b6="en"end;local bz="TQG_QuestsGroup"local bA={[4107]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.3161,0.1054,0.012,questId=4107,heading="",text=TQG.GroupQuestIdToTooltip[4107],allianceId=1}}},[4597]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.3161,0.1054,0.012,questId=4597,heading="",text=TQG.GroupQuestIdToTooltip[4597],allianceId=1}}},[4336]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5268,0.4841,0.012,questId=4336,heading="",text=TQG.GroupQuestIdToTooltip[4336],allianceId=1}}},[4675]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5268,0.4841,0.012,questId=4675,heading="",text=TQG.GroupQuestIdToTooltip[4675],allianceId=1}}},[4778]={[GetMapNameByIndex(GetMapIndexByZoneId(108))]={{0.6585,0.3000,0.012,questId=4778,heading="",text=TQG.GroupQuestIdToTooltip[4778],allianceId=1}}},[5120]={[GetMapNameByIndex(GetMapIndexByZoneId(108))]={{0.6585,0.3000,0.012,questId=5120,heading="",text=TQG.GroupQuestIdToTooltip[5120],allianceId=1}}},[4538]={[GetMapNameByIndex(GetMapIndexByZoneId(58))]={{0.7142,0.3371,0.012,questId=4538,heading="",text=TQG.GroupQuestIdToTooltip[4538],allianceId=1}}},[4733]={[GetMapNameByIndex(GetMapIndexByZoneId(382))]={{0.2063,0.7974,0.012,questId=4733,heading="",text=TQG.GroupQuestIdToTooltip[4733],allianceId=1}}},[4054]={[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.7146,0.3372,0.012,questId=4054,heading="",text=TQG.GroupQuestIdToTooltip[4054],allianceId=1}}},[4555]={[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.7146,0.3372,0.012,questId=4555,heading="",text=TQG.GroupQuestIdToTooltip[4555],allianceId=1}}},[4246]={[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.5620,0.5772,0.012,questId=4246,heading="",text=TQG.GroupQuestIdToTooltip[4246],allianceId=1}}},[4813]={[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.5620,0.5772,0.012,questId=4813,heading="",text=TQG.GroupQuestIdToTooltip[4813],allianceId=1}}},[4379]={[GetMapNameByIndex(GetMapIndexByZoneId(20))]={{0.7222,0.7363,0.012,questId=4379,heading="",text=TQG.GroupQuestIdToTooltip[4379],allianceId=1}}},[5113]={[GetMapNameByIndex(GetMapIndexByZoneId(20))]={{0.7222,0.7363,0.012,questId=5113,heading="",text=TQG.GroupQuestIdToTooltip[5113],allianceId=1}}},[4432]={[GetMapNameByIndex(GetMapIndexByZoneId(104))]={{0.8733,0.4636,0.012,questId=4432,heading="",text=TQG.GroupQuestIdToTooltip[4432],allianceId=1}}},[4589]={[GetMapNameByIndex(GetMapIndexByZoneId(92))]={{0.3718,0.2773,0.012,questId=4589,heading="",text=TQG.GroupQuestIdToTooltip[4589],allianceId=1}}},[3993]={[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.0960,0.4483,0.012,questId=3993,heading="",text=TQG.GroupQuestIdToTooltip[3993],allianceId=1}}},[4303]={[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.0960,0.4483,0.012,questId=4303,heading="",text=TQG.GroupQuestIdToTooltip[4303],allianceId=1}}},[4145]={[GetMapNameByIndex(GetMapIndexByZoneId(57))]={{0.7906,0.5859,0.012,questId=4145,heading="",text=TQG.GroupQuestIdToTooltip[4145],allianceId=1}}},[4641]={[GetMapNameByIndex(GetMapIndexByZoneId(57))]={{0.7906,0.5859,0.012,questId=4641,heading="",text=TQG.GroupQuestIdToTooltip[4641],allianceId=1}}},[4202]={[GetMapNameByIndex(GetMapIndexByZoneId(117))]={{0.1663,0.5852,0.012,questId=4202,heading="",text=TQG.GroupQuestIdToTooltip[4202],allianceId=1}}},[4346]={[GetMapNameByIndex(GetMapIndexByZoneId(101))]={{0.7367,0.7031,0.012,questId=4346,heading="",text=TQG.GroupQuestIdToTooltip[4346],allianceId=1}}},[4469]={[GetMapNameByIndex(GetMapIndexByZoneId(103))]={{0.8909,0.6468,0.012,questId=4469,heading="",text=TQG.GroupQuestIdToTooltip[4469],allianceId=1}}},[4822]={[GetMapNameByIndex(GetMapIndexByZoneId(347))]={{0.5793,0.4849,0.012,questId=4822,heading="",text=TQG.GroupQuestIdToTooltip[4822],allianceId=1}}},[5102]={[GetMapNameByIndex(GetMapIndexByZoneId(888))]={{0.8759,0.6057,0.012,questId=5102,heading="",text=TQG.GroupQuestIdToTooltip[5102],allianceId=1}}},[5087]={[GetMapNameByIndex(GetMapIndexByZoneId(888))]={{0.2375,0.6214,0.012,questId=5087,heading="",text=TQG.GroupQuestIdToTooltip[5087],allianceId=1}}},[5743]={[GetMapNameByIndex(GetMapIndexByZoneId(888))]={{0.3859,0.2602,0.012,questId=5743,heading="",text=TQG.GroupQuestIdToTooltip[5743],allianceId=1}}},[5136]={[GetMapNameByIndex(GetMapIndexByZoneId(181))]={{0.4979,0.3912,0.012,questId=5136,heading="",text=TQG.GroupQuestIdToTooltip[5136],allianceId=1}}},[5342]={[GetMapNameByIndex(GetMapIndexByZoneId(181))]={{0.4979,0.3912,0.012,questId=5342,heading="",text=TQG.GroupQuestIdToTooltip[5342],allianceId=1}}},[5448]={[GetMapNameByIndex(GetMapIndexByZoneId(684))]={{0.9305,0.3627,0.012,questId=5448,heading="",text=TQG.GroupQuestIdToTooltip[5448],allianceId=1}}},[5554]={[GetMapNameByIndex(GetMapIndexByZoneId(816))]={{0.6170,0.4737,0.012,questId=5554,heading="",text=TQG.GroupQuestIdToTooltip[5554],allianceId=1}}},[5352]={[GetMapNameByIndex(GetMapIndexByZoneId(382))]={{0.2259,0.7442,0.012,questId=5352,heading="",text=TQG.GroupQuestIdToTooltip[5352],allianceId=1}}},[6000]={[GetMapNameByIndex(GetMapIndexByZoneId(849))]={{0.4833,0.9006,0.012,questId=6000,heading="",text=TQG.GroupQuestIdToTooltip[6000],allianceId=1}}},[5894]={[GetMapNameByIndex(GetMapIndexByZoneId(849))]={{0.7686,0.5844,0.012,questId=5894,heading="",text=TQG.GroupQuestIdToTooltip[5894],allianceId=1}}},[6090]={[GetMapNameByIndex(GetMapIndexByZoneId(980))]={{0.3634,0.3471,0.012,questId=6090,heading="",text=TQG.GroupQuestIdToTooltip[6090],allianceId=1}}},[6193]={[GetMapNameByIndex(GetMapIndexByZoneId(1011))]={{0.2729,0.6150,0.012,questId=6193,heading="",text=TQG.GroupQuestIdToTooltip[6193],allianceId=1}}},[6192]={[GetMapNameByIndex(GetMapIndexByZoneId(1011))]={{0.4228,0.3593,0.012,questId=6192,heading="",text=TQG.GroupQuestIdToTooltip[6192],allianceId=1}}},[6269]={[GetMapNameByIndex(GetMapIndexByZoneId(726))]={{0.3092,0.5398,0.012,questId=6269,heading="",text=TQG.GroupQuestIdToTooltip[6269],allianceId=1}}},[6354]={[GetMapNameByIndex(GetMapIndexByZoneId(1086))]={{0.7781,0.3152,0.012,questId=6354,heading="",text=TQG.GroupQuestIdToTooltip[6354],allianceId=1}}},[6353]={[GetMapNameByIndex(GetMapIndexByZoneId(1086))]={{0.3426,0.7417,0.012,questId=6353,heading="",text=TQG.GroupQuestIdToTooltip[6353],allianceId=1}}},[6504]={[GetMapNameByIndex(GetMapIndexByZoneId(1160))]={{0.5375,0.4224,0.012,questId=6504,heading="",text=TQG.GroupQuestIdToTooltip[6504],allianceId=1}}},[6503]={[GetMapNameByIndex(GetMapIndexByZoneId(1160))]={{0.4303,0.2448,0.012,questId=6503,heading="",text=TQG.GroupQuestIdToTooltip[6503],allianceId=1}}},[6597]={[GetMapNameByIndex(GetMapIndexByZoneId(1207))]={{0.3118,0.5128,0.012,questId=6597,heading="",text=TQG.GroupQuestIdToTooltip[6597],allianceId=1}}},[6610]={[GetMapNameByIndex(GetMapIndexByZoneId(1207))]={{0.4730,0.7487,0.012,questId=6610,heading="",text=TQG.GroupQuestIdToTooltip[6610],allianceId=1}}},[6655]={[GetMapNameByIndex(GetMapIndexByZoneId(1261))]={{0.28188,0.53917,0.012,questId=6655,heading="",text=TQG.GroupQuestIdToTooltip[6655],allianceId=1}}},[6654]={[GetMapNameByIndex(GetMapIndexByZoneId(1261))]={{0.75500,0.92706,0.012,questId=6654,heading="",text=TQG.GroupQuestIdToTooltip[6654],allianceId=1}}},[0]={[GetMapNameByIndex(GetMapIndexByZoneId(0))]={{0.0000,0.0000,0.012,questId=0,heading="",text=TQG.GroupQuestIdToTooltip[0],allianceId=1}}}}function TQG.Group:SetupPins()local function bC(bD)local bE=GetMapName()local b8=TQG.trackedGroupQuestId;if bA[b8]==nil then return end;if bA[b8][bE]==nil then return end;local bF=bA[b8][bE]for _,bG in ipairs(bF)do bD:CreatePin(_G[bz],bG,bG[1],bG[2])end end;local bH=bC;local bI=nil;pinLayoutData={showsPinAndArea=true,level=10,minSize=100,texture="EsoUI/Art/MapPins/MapAutoNavigationPing.dds",isAnimated=true,framesWide=32,framesHigh=1,framesPerSecond=32}local bJ={creator=function(bK)local bL,au;local bE=GetMapName()local b8=TQG.trackedGroupQuestId;if bA[b8]==nil then return end;if bA[b8][bE]==nil then return end;local bF=bA[b8][bE]for _,bG in ipairs(bF)do if bG[4]==bK.m_PinTag[4]then bL=GetQuestName(bG.questId)au=zo_strformat("<<1>>)",bG.text)break end end;InformationTooltip:AddLine(bL,"ZoFontGameOutline",ZO_SELECTED_TEXT:UnpackRGB())ZO_Tooltip_AddDivider(InformationTooltip)InformationTooltip:AddLine(au,"",ZO_HIGHLIGHT_TEXT:UnpackRGB())end,tooltip=1}ZO_WorldMap_AddCustomPin(bz,bH,bI,pinLayoutData,bJ)ZO_WorldMap_SetCustomPinEnabled(_G[bz],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[bz])end;local function bM(bN,bO,bP,b9)local bE=GetMapName()local b8=TQG.trackedGroupQuestId;if bA[b8][bE]==nil then return end;local bF=bA[b8][bE]for _,bG in ipairs(bF)do if bP==LibUespQuestData:GetUespQuestName(bG.questId)then ZO_WorldMap_SetCustomPinEnabled(_G[bz],false)ZO_WorldMap_RefreshCustomPinsOfType(_G[bz])EVENT_MANAGER:UnregisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED)break end end end;function TQG.Group:PlayStory_OnClick()local I,a0,objectiveIndex;I,a0=cf()objectiveIndex=TQG.trackedGroupObjectiveIndex;if I<1 then return end;questForGroupIncomplete,questForGroupInProgress=ch(I,a0)if objectiveIndex then local b8=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].internalId;local bz=bz;local bR=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].mapIndex;local bE=GetMapNameByIndex(bR)TQG.trackedGroupQuestId=b8;if questForGroupInProgress then for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==LibUespQuestData:GetUespQuestName(b8)then local bS=k;ZO_WorldMap_ShowQuestOnMap(bS)return end end end;if bA[b8][bE]==nil then return end;local bF=bA[b8][bE]local bT,bU;for _,bG in ipairs(bF)do if bG.questId==b8 then bT=bG[1]bU=bG[2]break end end;ZO_WorldMap_SetCustomPinEnabled(_G[bz],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[bz])ZO_WorldMap_ShowWorldMap()zo_callLater(function()ZO_WorldMap_SetMapByIndex(bR)end,1000)zo_callLater(function()ZO_WorldMap_PanToNormalizedPosition(bT,bU)end,1750)EVENT_MANAGER:RegisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED,bM)end end;function TQG.Group:UpdateStoryButtons(S)TQG.Group.dungeonQuestAcceptButton:SetEnabled(false)TQG.Group.dungeonQuestAcceptButton:SetHidden(true)local I,a0;if S then for k=1,#TQG.TopLevelGroup do for aH=1,#TQG.ZoneLevelGroup[k]do local _,cj=S.name:find(".dds",8,false)local ck=cj+4;if TQG.ZoneLevelGroup[k][aH].zoneName==S.name:sub(ck)then I=k;a0=aH;TQG.selectedGroupZoneId=TQG.ZoneLevelGroup[k][aH].id;break end end end end;if not I or not a0 then TQG.Group.playStoryButton:SetEnabled(false)TQG.Group.playStoryButton:SetText("")TQG.Group.playStoryButton:SetHidden(false)return end;for k=1,#TQG.ObjectiveLevelGroup[I][a0]do local b8=TQG.ObjectiveLevelGroup[I][a0][k].internalId;if GetCompletedQuestInfo(b8)~=""and GetCompletedQuestInfo(b8)~=nil then TQG.Group.playStoryButton:SetEnabled(false)TQG.Group.playStoryButton:SetText(GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING))TQG.Group.playStoryButton:SetHidden(false)TQG.trackedGroupObjectiveIndex=k else TQG.Group.playStoryButton:SetEnabled(true)TQG.Group.playStoryButton:SetText("Show Quest")TQG.Group.playStoryButton:SetHidden(false)TQG.trackedGroupObjectiveIndex=k;break end end end;function TQG.Group:StoryButtonHooks(b0)local b1=GetControl(b0)local b2=b1:GetNamedChild("ButtonContainer")TQG.Group.playStoryButton=b2:GetNamedChild("PlayStoryButton")TQG.Group.playStoryButton:SetClickSound(SOUNDS.ZONE_STORIES_TRACK_ACTIVITY)TQG.Group.dungeonQuestAcceptButton=b2:GetNamedChild("QuestAccept")end;function TQG.Group:Initialize(m)local cl=TQG.sceneNameQuestGuideGroup;TQG_GROUP_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabGroup)TQG_SCENE_GROUP=ZO_Scene:New(cl,SCENE_MANAGER)TQG_SCENE_GROUP:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_GROUP:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_GROUP:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_GROUP:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_GROUP:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_GROUP:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_GROUP:AddFragment(TITLE_FRAGMENT)TQG_SCENE_GROUP:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_GROUP:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_GROUP:AddFragment(TQG_GROUP_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(cl,TQG_SCENE_GROUP)TQG_SCENE_GROUP:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=4;TQG.MenuHidden=false;TQGButtonsButton1.m_object:SetState(0)TQGButtonsButton1.m_object:SetLocked(false)TQGButtonsButton2.m_object:SetState(0)TQGButtonsButton2.m_object:SetLocked(false)TQGButtonsButton3.m_object:SetState(0)TQGButtonsButton3.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)TQG.ButtonSetup(m)TQG.Group:StoryButtonHooks("TQG_TabGroup")end;function TQG.Group:New(m)TQG.Group:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabGroup_ObjectiveLine",m,"Objective")q.currentProgressionLevel=#TQG.TopLevelGroup;q:InitializeCategoryList(m)q:RefreshList()local function b4()q:RefreshList()end;local function c0()q:RefreshList()end;local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_ADDED,b4)m:RegisterForEvent(EVENT_QUEST_REMOVED,c0)m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.Group:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"/esoui/art/charactercreate/charactercreate_aldmeriicon_down.dds","/esoui\art/charactercreate/charactercreate_aldmeriicon_up.dds","/esoui/art/charactercreate/charactercreate_aldmeriicon_over.dds"},[2]={"/esoui/art/charactercreate/charactercreate_daggerfallicon_down.dds","/esoui\art/charactercreate/charactercreate_daggerfallicon_up.dds","/esoui/art/charactercreate/charactercreate_daggerfallicon_over.dds"},[3]={"/esoui/art/charactercreate/charactercreate_ebonhearticon_down.dds","/esoui\art/charactercreate/charactercreate_ebonhearticon_up.dds","/esoui/art/charactercreate/charactercreate_ebonhearticon_over.dds"},[4]={"esoui/art/treeicons/antiquities_tabicon_coldharbour_down.dds","esoui\art/treeicons/antiquities_tabicon_coldharbour_up.dds","esoui/art/treeicons/antiquities_tabicon_coldharbour_over.dds"},[5]={"esoui/art/treeicons/antiquities_tabicon_craglorn_down.dds","esoui\art/treeicons/antiquities_tabicon_craglorn_up.dds","esoui/art/treeicons/antiquities_tabicon_craglorn_over.dds"},[6]={"esoui/art/treeicons/store_indexicon_dlc_down.dds","esoui\art/treeicons/store_indexicon_dlc_up.dds","esoui/art/treeicons/store_indexicon_dlc_over.dds"},[7]={"esoui/art/icons/progression_tabicon_daedricconjuration_down.dds","esoui\art/icons/progression_tabicon_daedricconjuration_up.dds","esoui/art/icons/progression_tabicon_daedricconjuration_over.dds"},[8]={"/esoui/art/treeicons/tutorial_idexicon_murkmire_down.dds","/esoui\art/treeicons/tutorial_idexicon_murkmire_up.dds","/esoui/art/treeicons/tutorial_idexicon_murkmire_over.dds"},[9]={"esoui/art/icons/progression_tabicon_dragonaspect_down.dds","esoui\art/icons/progression_tabicon_dragonaspect_up.dds","esoui/art/icons/progression_tabicon_dragonaspect_over.dds"},[10]={"esoui/art/icons/progression_tabicon_darkmagic_down.dds","esoui\art/icons/progression_tabicon_darkmagic_up.dds","esoui/art/icons/progression_tabicon_darkmagic_over.dds"},[11]={"esoui/art/icons/heraldrycrests_daedra_mehronesdagon_01.dds","esoui\art\icons\heraldrycrests_daedra_mehronesdagon_01.dds","esoui/art/icons/heraldrycrests_daedra_mehronesdagon_01.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelGroup[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,nil,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then TQG.Group:UpdateStoryButtons(S)self:RefreshDetails()end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local a7=TQG.ZoneLevelGroup[I][a0].name;local b5=TQG.ZoneLevelGroup[I][a0].id;local a2=""local a1;if type(a7)=="number"or a7==""then a7=TQG.ZoneLevelGroup[I][a0].name;a7="("..string.format("%.2f",a7)..")"local b6=GetCVar("language.2")if b6=="de"or b6=="fr"or b6=="ru"then a7=string.gsub(a7,"%.",",",1)end;local cm=TQG.ZoneLevelGroup[I][a0].zoneName;a1=cm or GetZoneNameById(b5)local cn=TQG.ZoneLevelGroup[I][a0].type;if cn=="Dungeon"or cn=="Arena"then a1=string.format("%s |t32:32:%s|t %s",a7,"/esoui/art/icons/poi/poi_groupinstance_complete.dds",a1)elseif cn=="Trial"or cn=="Maelstrom Arena"then a1=string.format("%s |t32:32:%s|t %s",a7,"/esoui/art/icons/poi/poi_raiddungeon_complete.dds",a1)end end;if type(b5)=="string"then a2=b5 else a2=GetZoneDescriptionById(b5)end;local a3=a0;return b5,a1,a2,a3 end;local function b7(I,a0,objectiveIndex,aJ)local b6=GetCVar("language.2")if b6~="de"and b6~="fr"and b6~="ru"then b6="en"end;local a6=false;local aj=objectiveIndex;local a7,a8,a9,a5;local b8,b9,ba,bb;local aP=TQG.ZoneLevelGroup[I][a0].id;local co=false;local overrideName=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].overrideQName or nil;b8=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].internalId;a7=GetQuestName(b8)if overrideName then a7=overrideName end;if b8==5743 then for k,cp in ipairs(TQG.MultiQuestIds[11])do local cq,cr;if b6=="fr"then cq="Le fantôme aîné"cr="L'aîné des fantômes"end;local bi=GetCompletedQuestInfo(cp)or""if bi==a7 or bi==cq or bi==langTwo then local b5=cp;b8=b5;bb=LibUespQuestData:GetUespQuestBackgroundText(b5)co=true;break end end end;if not b8 then for k,bk in pairs(LibUespQuestData.quests)do local b5=tonumber(bk.internalId)local bi=""bi=GetCompletedQuestInfo(b5)if bi==""or bi==nil then bi=GetCompletedQuestInfo(b5)or""end;if LibUespQuestData:GetUespQuestName(b5)==a7 and not overrideName then b8=b5;bb=LibUespQuestData:GetUespQuestBackgroundText(b5)_,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b5)if b9==""then b9=nil end;break elseif bi==a7 then b8=b5;bb=LibUespQuestData:GetUespQuestBackgroundText(b5)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9=LibUespQuestData:GetUespQuestLocationInfo(b5)end;if b9==""then b9=nil end;break end end elseif not co then bb=LibUespQuestData:GetUespQuestBackgroundText(b8)if TQG.POIData[b8]then b9=GetPOIInfo(TQG.POIData[b8].zoneIndex,TQG.POIData[b8].poiIndex)else _,b9,ba=LibUespQuestData:GetUespQuestLocationInfo(b8)end;if b9==""then b9=nil end end;if type(aP)=="string"then local cs,_=aP:find(":",1,true)a8=b9 or aP:sub(1,cs-1)else a8=nil end;if GetCompletedQuestInfo(b8)==""and not co then a6=false;for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==a7 then a5=true;_,a8=GetJournalQuestInfo(k)break else a5=false end end;a9=""else a6=true;a5=true;a8=""a9=bb end;local function bl(bm,bn)if a7==LibUespQuestData:GetUespQuestName(bn)then bm=string.gsub(bm," u2026.","...")else bm=string.gsub(bm," u2026","...")end;return bm end;if bb~=""and bb then if a9==bb then a9=bl(a9,4296)a9=bl(a9,-1)a9=string.gsub(a9,"u2014","—")elseif a8==bb then a8=bl(a8,4296)a8=bl(a8,-1)a8=string.gsub(a8,"u2014","—")end end;local bo=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].overrideZone;if a8==nil or a8==""or bo then a8=bo;if a8==nil or a8==""then a8=GetString(TQG_DEFAULT_QUEST_INCOMPLETE_STRING)end end;if a9==nil or a9==""then a9=GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING)end;local bp=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].optional or false;return a7,a8,a9,aj,a5,a6,bp end;function TQG.Group:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local aa={}for I=1,#TQG.TopLevelGroup do local ab=#TQG.ZoneLevelGroup[I]if self.currentProgressionLevel<I then break end;if ab>0 then local ac=self.navigationTree:AddNode("ZO_IconHeader",I)for ad=1,ab do local aP,a1,a2,a3=Z(I,ad)local bq=0;local ae=true;local af={}local aJ,aK,br,bs;aJ,aK,br,bs=0,0,0,0;local ag=br;local bt=false;if bs>0 then ag=ag+1;bt=true end;if ag==0 then ag=#TQG.ObjectiveLevelGroup[I][ad]end;local bu=1;if ag~=#TQG.ObjectiveLevelGroup[I][ad]then if TQG.ObjectiveLevelGroup[I][ad][0]then bu=0;local bg=TQG.ObjectiveLevelGroup[I][ad][0].prologueQIds;if bg and bg>1 then ag=ag+bg-1 end elseif TQG.ObjectiveLevelGroup[I][ad][ag+1].overrideDetails then ag=ag+#TQG.ObjectiveLevelGroup[I][ad]-ag end end;for objectiveIndex=bu,ag do local a7,ah,ai,aj,ak,al,bv;if objectiveIndex==ag and bt==true then a7="TBC"ah,ai=GetErrorString(bs)aj=objectiveIndex;ak=false;al=false;bv=false else a7,ah,ai,aj,ak,al,bv=b7(I,ad,objectiveIndex,aJ)ae=ae and(al or bv)if al then bq=bq+1 end end;table.insert(af,{name=a7,openingText=ah,closingText=ai,order=aj,discovered=ak,completed=al})end;table.sort(af,ZO_CadwellSort)table.insert(aa,{name=a1,description=a2,order=a3,completed=ae and bq>=1,objectives=af,parent=ac})end end end;table.sort(aa,ZO_CadwellSort)for k=1,#aa do local am=aa[k]local ac=am.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",am,ac)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.Group:RefreshDetails()local self=TQG_ALMANAC_GROUP;self.objectiveLinePool:ReleaseAllObjects()local an=self.navigationTree:GetSelectedData()if not an or not an.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;local ct=zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,an.name)self.titleText:SetText(ct)self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,an.description))local ao;for k=1,#an.objectives do local ap=an.objectives[k]local aq=self.objectiveLinePool:AcquireObject()if ap.name=="TBC"then aq:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(ap.openingText)elseif ap.discovered and not ap.completed then aq:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))elseif not ap.discovered then aq:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(true)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.openingText))else aq:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(aq,"Check"):SetHidden(false)aq:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ap.name,ap.closingText))end;if not ao then aq:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else aq:SetAnchor(TOPLEFT,ao,BOTTOMLEFT,0,15)end;ao=aq end end;function TQG.Group:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabGroup_OnShown()TQG_ALMANAC_GROUP:OnShown()end;function TQG_TabGroup_Initialize(m)TQG_ALMANAC_GROUP=TQG.Group:New(m)end