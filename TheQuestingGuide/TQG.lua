if not TQG then TQG={}end;TQG.Overview=ZO_Object:Subclass()local a="TheQuestingGuide"TQG.sceneNameQuestGuideOverview="QuestGuideOverview"TQG.Overview.minClassicLinks=1;TQG.Overview.maxClassicLinks=2;TQG.Overview.minDLCLinks=1;TQG.Overview.maxDLCLinks=2;local function b()return true end;local c="現在、日本語では操作できません"local e="アドオンは、現在日本語でサポートされていない手動でキュレートされたデータベースと一致するために、いくつかの完了したクエストを必要とします。多くのクエストを完了し、日本人ユーザー向けの翻訳を作成したい場合は、https：//esoui.c​​omで著者に直接メッセージを送信してください。ご不便をおかけして申し訳ございません。私たちはあなたの助けを借りて将来的にサポートを追加できます。"local f={mustChoose=false,title={text=c},mainText={text=e},buttons={[1]={keybind="DIALOG_NEGATIVE",text=SI_DIALOG_CANCEL,callback=function()return end}}}ZO_Dialogs_RegisterCustomDialog("TQG_JAPANESE_ERROR_DIALOGUE",f)function TQG:ToggleMenu()if GetCVar("language.2")=="jp"then ZO_Dialogs_ShowDialog("TQG_JAPANESE_ERROR_DIALOGUE")return end;if not b()then return end;if not TQG.MenuState then TQG.MenuState=0 end;if TQG.MenuHidden==nil then TQG.MenuHidden=true end;local g=TQG.MenuState;local h=TQG.MenuHidden;local i={[1]=TQG.sceneNameQuestGuideOverview,[2]=TQG.sceneNameQuestGuideClassic,[3]=TQG.sceneNameQuestGuideDLC,[4]=TQG.sceneNameQuestGuideGroup}if g==0 then g=1;h=false;TQGButtonsButton1.m_object:SetState(1)TQGButtonsButton1.m_object:SetLocked(true)SCENE_MANAGER:Show(i[1])elseif h==true then SCENE_MANAGER:Show(i[g])h=false elseif h==false then SCENE_MANAGER:Hide(i[g])h=true end;TQG.MenuState=g;TQG.MenuHidden=h end;function TQG:IsGuideHidden()local j={TQG.sceneNameQuestGuideOverview,TQG.sceneNameQuestGuideClassic,TQG.sceneNameQuestGuideDLC,TQG.sceneNameQuestGuideGroup}for k,l in ipairs(j)do if SCENE_MANAGER:IsShowing(l)then return false end end;return true end;function TQG.Overview:Initialize(m)TQG.BACKGROUND_FRAGMENT=ZO_FadeSceneFragment:New(TQG_SharedRightBackground)local n=TQG.sceneNameQuestGuideOverview;TQG_OVERVIEW_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabOverview)TQG_SCENE_OVERVIEW=ZO_Scene:New(n,SCENE_MANAGER)TQG_SCENE_OVERVIEW:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_OVERVIEW:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_OVERVIEW:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_OVERVIEW:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_OVERVIEW:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_OVERVIEW:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_OVERVIEW:AddFragment(TITLE_FRAGMENT)TQG_SCENE_OVERVIEW:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_OVERVIEW:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_OVERVIEW:AddFragment(TQG_OVERVIEW_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(n,TQG_SCENE_Overview)TQG_SCENE_OVERVIEW:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=1;TQG.MenuHidden=false;TQGButtonsButton2.m_object:SetState(0)TQGButtonsButton2.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)end;function TQG.Overview:New(m)TQG.Overview:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabOverview_ObjectiveLine",m,"Objective")local r,s,t,u,v,w,x=q.zoneInfoContainer:GetAnchor(0)local y,z,A,B,C,D,E=q.zoneInfoContainer:GetAnchor(1)q.zoneInfoContainer:ClearAnchors()q.zoneInfoContainer:SetAnchor(s,t,u,v,w)q.zoneInfoContainer:SetAnchor(z,A,B,v,100)q.currentProgressionLevel=#TQG.TopLevelOverview;q:InitializeCategoryList(m)q:RefreshList()local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.Overview:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"esoui/art/progression/progression_indexicon_world_down.dds","esoui/art/progression/progression_indexicon_world_up.dds","esoui/art/progression/progression_indexicon_world_over.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function J(K,m,I,L)local M=m:GetNamedChild("Text")end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelOverview[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)K.selectionFunction=J(K,m,I,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,J,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then self:RefreshDetails()if S.name~=TQG.ZoneLevelOverview[1][1].name then for k=TQG.Overview.minClassicLinks,TQG.Overview.maxClassicLinks do notesWithLinks[1][k]:SetHidden(true)end;for k=TQG.Overview.minDLCLinks,TQG.Overview.maxDLCLinks do notesWithLinks[2][k]:SetHidden(false)end end;if S.name~=TQG.ZoneLevelOverview[1][2].name then for k=TQG.Overview.minClassicLinks,TQG.Overview.maxClassicLinks do notesWithLinks[1][k]:SetHidden(false)end;for k=TQG.Overview.minDLCLinks,TQG.Overview.maxDLCLinks do notesWithLinks[2][k]:SetHidden(true)end end;if S.name==TQG.ZoneLevelOverview[1][3].name then for k=TQG.Overview.minClassicLinks,TQG.Overview.maxClassicLinks do notesWithLinks[1][k]:SetHidden(true)end;for k=TQG.Overview.minDLCLinks,TQG.Overview.maxDLCLinks do notesWithLinks[2][k]:SetHidden(true)end end end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local zoneName=TQG.ZoneLevelOverview[I][a0].name;local a1=TQG.ZoneLevelOverview[I][a0].id;local a2=a0;return zoneName,a1,a2 end;local function a3(I,a0,objectiveIndex)local a4=true;local a5=false;local a6=TQG.ObjectiveLevelOverview[I][a0][objectiveIndex].name;local a7=TQG.ObjectiveLevelOverview[I][a0][objectiveIndex].description;local a8=TQG.ObjectiveLevelOverview[I][a0][objectiveIndex].description;return a6,a7,a8,objectiveIndex,a4,a5 end;function TQG.Overview:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local a9={}for I=1,#TQG.TopLevelOverview do local aa=#TQG.ZoneLevelOverview[I]if self.currentProgressionLevel<I then break end;if aa>0 then local ab=self.navigationTree:AddNode("ZO_IconHeader",I)for ac=1,aa do local zoneName,a1,a2=Z(I,ac)local ad=true;local ae={}local af=#TQG.ObjectiveLevelOverview[I][ac]for objectiveIndex=1,af do local a6,ag,ah,ai,aj,ak=a3(I,ac,objectiveIndex)ad=ad and ak;table.insert(ae,{name=a6,openingText=ag,closingText=ah,order=ai,discovered=aj,completed=ak})end;table.sort(ae,ZO_CadwellSort)table.insert(a9,{name=zoneName,description=a1,order=a2,completed=ad,objectives=ae,parent=ab})end end end;table.sort(a9,ZO_CadwellSort)for k=1,#a9 do local al=a9[k]local ab=al.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",al,ab)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.Overview:RefreshDetails()local self=TQG_ALMANAC_OVERVIEW;self.objectiveLinePool:ReleaseAllObjects()local am=self.navigationTree:GetSelectedData()if not am or not am.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;self.titleText:SetText(zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,am.name))self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,am.description))local an;for k=1,#am.objectives do local ao=am.objectives[k]local ap=self.objectiveLinePool:AcquireObject()if ao.discovered and not ao.completed then ap:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))elseif not ao.discovered then ap:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))else ap:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(false)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.closingText))end;if not an then ap:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else ap:SetAnchor(TOPLEFT,an,BOTTOMLEFT,0,15)end;an=ap end end;function TQG.Overview:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabOverview_OnShown()TQG_ALMANAC_OVERVIEW:OnShown()end;function TQG_TabOverview_Initialize(m)TQG_ALMANAC_OVERVIEW=TQG.Overview:New(m)end;local function aq(ar,as,at,au)local m=GetControl("TQG_TabOverviewZoneStepContainer")local av="Click_MenuBar"local aw=200;local ax=28;local ay=0;local az=10;if not notesWithLinks then notesWithLinks={}notesWithLinks[1]={}notesWithLinks[2]={}notesWithLinks[3]={}end;notesWithLinks[ar][#notesWithLinks[ar]+1]=CreateControlFromVirtual(as,m,"ZO_DefaultButton")local aA=math.fmod(#notesWithLinks[ar],3)if#notesWithLinks[ar]>=2 and#notesWithLinks[ar]<=3 then ay=(#notesWithLinks[ar]-1)*190 elseif#notesWithLinks[ar]>=4 then if aA~=1 then if aA==0 then ay=2*190 else ay=(math.fmod(#notesWithLinks[ar],3)-1)*190 end end;az=(math.ceil(#notesWithLinks[ar]/3)-1)*(33+az)end;notesWithLinks[ar][#notesWithLinks[ar]]:SetAnchor(LEFT,m,LEFT,ay,az)notesWithLinks[ar][#notesWithLinks[ar]]:SetDimensions(aw,ax)notesWithLinks[ar][#notesWithLinks[ar]]:SetHandler("OnClicked",function()RequestOpenUnsafeURL(au)end)notesWithLinks[ar][#notesWithLinks[ar]]:SetText(at)end;DefaultValues={["en"]={},["de"]={},["fr"]={},["ru"]={},["ruMaps"]={}}local function aB(aC,aD)if aD~=a then return end;if not b()then return end;TQG.DLC:SetupPins()TQG.Group:SetupPins()aq(1,"TQGNoteLink1.1",TQG.BtnQuestMap,"https://en.uesp.net/wiki/Online:Story_Quests#Quest_Map")aq(1,"TQGNoteLink1.2",TQG.BtnCraglorn,"https://en.uesp.net/wiki/Online:Craglorn#Quest_Map")aq(2,"TQGNoteLink2.1",TQG.BtnImperalCity,"https://en.uesp.net/wiki/Online:Imperial_City#Quests")aq(2,"TQGNoteLink2.2",TQG.BtnOrsinium,"https://en.uesp.net/wiki/Online:Wrothgar#Quest_Map")EVENT_MANAGER:UnregisterForEvent("TheQuestingGuide",EVENT_ADD_ON_LOADED)end;EVENT_MANAGER:RegisterForEvent("TheQuestingGuide",EVENT_ADD_ON_LOADED,aB)local function aE()TQG:ToggleMenu()end;SLASH_COMMANDS["/tqg"]=aE;if not TQG then TQG={}end;TQG.Classic=ZO_Object:Subclass()TQG.sceneNameQuestGuideClassic="QuestGuideClassic"TQG.selectedClassicZoneId=nil;TQG.trackedClassicZoneId=nil;TQG.ConfirmContinueClassicToEndingQuests={mustChoose=false,title={text=GetString(TQG_CONFIRM_QUEST_TITLE)},mainText={text=GetString(TQG_CONFIRM_MAIN_TEXT)},buttons={[1]={keybind="DIALOG_PRIMARY",text=GetString(TQG_CONFIRM_QUEST_ZONE_STORY),callback=function()TQG:TrackNextActivity(TQG.selectedClassicZoneId,nil)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.Classic:UpdateZoneStoryButtons()end},[2]={keybind="DIALOG_SECONDARY",text=GetString(TQG_CONFIRM_QUEST_POI),callback=function()TQG:TrackNextActivity(TQG.selectedClassicZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.Classic:UpdateZoneStoryButtons()end}}}ZO_Dialogs_RegisterCustomDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY",TQG.ConfirmContinueClassicToEndingQuests)local function aF()local I=0;local a0=0;local aG=1;for k=1,#TQG.ZoneLevelClassic do while aG<=#TQG.ZoneLevelClassic[k]do if TQG.ZoneLevelClassic[k][aG].id==TQG.selectedClassicZoneId then I=k;a0=aG;break end;aG=aG+1 end;if I>0 then break else aG=1 end end;return I,a0 end;local function aH(I,a0)local aI,aJ;aI,aJ,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedClassicZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)local aK=aJ-aI>0;aI,aJ,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedClassicZoneId,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)local aL=aJ-aI==TQG.ZoneLevelClassic[I][a0].PreEndSideQuestCheck;return false,false end;local function aM(I,a0)local self=TQG_ALMANAC_CLASSIC;local am=self.navigationTree:GetSelectedData()if not am or not am.objectives then return end;local aN;if TQG.ObjectiveLevelClassic[I][a0][0]then aN=TQG.ObjectiveLevelClassic[I][a0][0].prologueQIds else aN=nil end;if not aN then return false,false end;for k=1,aN do if am.objectives[k].discovered==false then return true,false,k-1 elseif am.objectives[k].completed==false then return true,true,k-1 end end;return false,false end;function TQG:TrackNextActivity(aO,aP)if aO then if ZO_ZoneStories_Shared.IsZoneCollectibleUnlocked(aO)then local aQ=true;local aR=aP;TrackNextActivityForZoneStory(aO,aR,aQ)else local ac=GetZoneIndex(aO)local aS=GetCollectibleIdForZone(ac)local aT=ZO_COLLECTIBLE_DATA_MANAGER:GetCollectibleDataById(aS)local aU=aT:GetCategoryType()if aU==COLLECTIBLE_CATEGORY_TYPE_CHAPTER then ZO_ShowChapterUpgradePlatformScreen(MARKET_OPEN_OPERATION_ZONE_STORIES)else local aV=zo_strformat(SI_CROWN_STORE_SEARCH_FORMAT_STRING,aT:GetName())ShowMarketAndSearch(aV,MARKET_OPEN_OPERATION_ZONE_STORIES)end end end end;function TQG:GetPlayStoryButtonText(aO)if type(aO)=="number"then if not ZO_ZoneStories_Shared.IsZoneCollectibleUnlocked(aO)then return ZO_ZoneStories_Shared.GetZoneCollectibleUnlockText(aO)elseif ZO_ZoneStories_Manager.IsZoneComplete(aO)then return zo_strformat(SI_ZONE_STORY_ZONE_COMPLETE_ACTION)elseif ZO_ZoneStories_Manager.IsZoneCompletionTypeComplete(aO,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)or not CanZoneStoryContinueTrackingActivitiesForCompletionType(aO,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)then return zo_strformat(SI_ZONE_STORY_EXPLORE_ZONE_ACTION)elseif not IsZoneStoryStarted(aO)then return zo_strformat(SI_ZONE_STORY_START_STORY_ACTION)else return zo_strformat(SI_ZONE_STORY_CONTINUE_STORY_ACTION)end end;return zo_strformat(SI_ZONE_STORY_CONTINUE_STORY_ACTION)end;function TQG.Classic:PlayStory_OnClick()local I,a0;local aK,aL;local aW;I,a0=aF()if I<1 then return end;aK,aL=aH(I,a0)aW,prologueForClassicInProgress,objectiveIndex=aM(I,a0)if TQG.ZoneLevelClassic[I][a0].SideQuestCheck and aK and aL then ZO_Dialogs_ShowDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY")else TQG:TrackNextActivity(TQG.selectedClassicZoneId)ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateZoneStoryButtons()end end;function TQG.Classic:StopTracking_OnClick()ClearTrackedZoneStory()ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateZoneStoryButtons()end;function TQG.Classic:UpdateZoneStoryButtons(S)if S then for k=1,#TQG.TopLevelClassic do for aG=1,#TQG.ZoneLevelClassic[k]do if TQG.ZoneLevelClassic[k][aG].name==S.name then TQG.selectedClassicZoneId=TQG.ZoneLevelClassic[k][aG].id;break end end end end;local aO=TQG.selectedClassicZoneId;local aX;local aY;if type(aO)=="string"then aX=false;aY=false else aX=ZO_ZoneStories_Manager.GetZoneAvailability(aO)aY=CanZoneStoryContinueTrackingActivities(aO)end;TQG.Classic.playStoryButton:SetEnabled(aX and aY)TQG.Classic.playStoryButton:SetText(TQG:GetPlayStoryButtonText(aO))local aZ=GetTrackedZoneStoryActivityInfo()TQG.Classic.stopTrackingButton:SetHidden(aZ~=aO)end;function TQG.Classic:StoryButtonHook(a_)local b0=GetControl(a_)local b1=b0:GetNamedChild("ButtonContainer")TQG.Classic.playStoryButton=b1:GetNamedChild("PlayStoryButton")TQG.Classic.playStoryButton:SetClickSound(SOUNDS.ZONE_STORIES_TRACK_ACTIVITY)TQG.Classic.stopTrackingButton=b1:GetNamedChild("StopTrackingButton")end;function TQG.Classic:Initialize(m)local b2=TQG.sceneNameQuestGuideClassic;TQG_CLASSIC_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabClassic)TQG_SCENE_CLASSIC=ZO_Scene:New(b2,SCENE_MANAGER)TQG_SCENE_CLASSIC:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_CLASSIC:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_CLASSIC:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_CLASSIC:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_CLASSIC:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_CLASSIC:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_CLASSIC:AddFragment(TITLE_FRAGMENT)TQG_SCENE_CLASSIC:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_CLASSIC:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_CLASSIC:AddFragment(TQG_CLASSIC_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(b2,TQG_SCENE_Classic)TQG_SCENE_CLASSIC:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=2;TQG.MenuHidden=false;TQGButtonsButton1.m_object:SetState(0)TQGButtonsButton1.m_object:SetLocked(false)TQGButtonsButton3.m_object:SetState(0)TQGButtonsButton3.m_object:SetLocked(false)TQGButtonsButton4.m_object:SetState(0)TQGButtonsButton4.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)TQG.Classic:StoryButtonHook("TQG_TabClassic")end;function TQG.Classic:New(m)TQG.Classic:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabClassic_ObjectiveLine",m,"Objective")q.currentProgressionLevel=#TQG.TopLevelClassic;q:InitializeCategoryList(m)q:RefreshList()local function b3()q:RefreshList()end;local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_ADDED,b3)m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.Classic:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"esoui/art/campaign/campaignbrowser_indexicon_specialevents_down.dds","esoui\art/campaign/campaignbrowser_indexicon_specialevents_up.dds","esoui/art/campaign/campaignbrowser_indexicon_specialevents_over.dds"},[2]={"/esoui/art/charactercreate/charactercreate_aldmeriicon_down.dds","/esoui\art/charactercreate/charactercreate_aldmeriicon_up.dds","/esoui/art/charactercreate/charactercreate_aldmeriicon_over.dds"},[3]={"/esoui/art/charactercreate/charactercreate_daggerfallicon_down.dds","/esoui\art/charactercreate/charactercreate_daggerfallicon_up.dds","/esoui/art/charactercreate/charactercreate_daggerfallicon_over.dds"},[4]={"/esoui/art/charactercreate/charactercreate_ebonhearticon_down.dds","/esoui\art/charactercreate/charactercreate_ebonhearticon_up.dds","/esoui/art/charactercreate/charactercreate_ebonhearticon_over.dds"},[5]={"esoui/art/icons/progression_tabicon_fightersguild_down.dds","esoui\art/icons/progression_tabicon_fightersguild_up.dds","esoui/art/icons/progression_tabicon_fightersguild_over.dds"},[6]={"esoui/art/icons/progression_tabicon_magesguild_down.dds","esoui\art/icons/progression_tabicon_magesguild_up.dds","esoui/art/icons/progression_tabicon_magesguild_over.dds"},[7]={"esoui/art/treeicons/antiquities_tabicon_coldharbour_down.dds","esoui\art/treeicons/antiquities_tabicon_coldharbour_up.dds","esoui/art/treeicons/antiquities_tabicon_coldharbour_over.dds"},[8]={"esoui/art/treeicons/antiquities_tabicon_craglorn_down.dds","esoui\art/treeicons/antiquities_tabicon_craglorn_up.dds","esoui/art/treeicons/antiquities_tabicon_craglorn_over.dds"},[9]={"EsoUI/Art/Campaign/campaign_tabIcon_browser_down.dds","EsoUI\Art/Campaign/campaign_tabIcon_browser_up.dds","EsoUI/Art/Campaign/campaign_tabIcon_browser_over.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function J(K,m,I,L)local M=m:GetNamedChild("Text")end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelClassic[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)K.selectionFunction=J(K,m,I,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,J,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then TQG.Classic:UpdateZoneStoryButtons(S)self:RefreshDetails()end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local a6=TQG.ZoneLevelClassic[I][a0].name;local b4=TQG.ZoneLevelClassic[I][a0].id;local a1=""if type(a6)=="number"or a6==""then a6=TQG.ZoneLevelClassic[I][a0].name;a6="("..string.format("%.2f",a6)..")"local b5=GetCVar("language.2")if b5~="de"and b5~="fr"then b5="en"end;if b5=="de"or b5=="fr"then a6=string.gsub(a6,"%.",",",1)end;zoneName=GetZoneNameById(b4)TQG.ZoneLevelClassic[I][a0].name=a6 .." "..zoneName end;local zoneName=TQG.ZoneLevelClassic[I][a0].name;if type(b4)=="string"then a1=b4 else a1=GetZoneDescriptionById(b4)end;local a2=a0;return b4,zoneName,a1,a2 end;local function b6(I,a0,objectiveIndex)local b5=GetCVar("language.2")if b5~="de"and b5~="fr"and b5~="ru"then b5="en"end;local a5=false;local ai=objectiveIndex;local a6,a7,a8,a4;local b7,b8,b9,ba;local aO=TQG.ZoneLevelClassic[I][a0].id;local bb=false;local bc=false;local bd=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideDetails;local be=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].internalId;if bd then local overrideName=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideQName or nil;b7=be;a6=GetCompletedQuestInfo(b7)if overrideName then a6=overrideName elseif a6==""then a6=LibUespQuestData:GetUespQuestName(b7)end else local bf=TQG.ObjectiveLevelClassic[I][a0][1].prologueQIds;if bf and objectiveIndex>=bf then ai=ai+bf-1;objectiveIndex=objectiveIndex-(bf-1)end;a6=GetZoneStoryActivityNameByActivityIndex(aO,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS,objectiveIndex)objectiveIndex=ai end;if not b7 then for k,bg in ipairs(TQG.MultiQuestIds[1])do local bh=GetCompletedQuestInfo(bg)or""if bh==a6 then local b4=4704;b7=b4;ba=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideDescription;if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b7)end;if b8==""then b8=nil end;bb=true;break end end end;if not b7 then for k=3,10 do for aG,bi in ipairs(TQG.MultiQuestIds[k])do local bh=GetCompletedQuestInfo(bi)or""if bh==a6 then b7=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].internalId;ba=LibUespQuestData:GetUespQuestBackgroundText(b7)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=nil,"",0 end;if b8==""then b8=nil end;bc=true;break end end end end;if not b7 then for k,bj in pairs(LibUespQuestData.quests)do local b4=tonumber(bj.internalId)local bh=GetCompletedQuestInfo(b4)if bh==""or bh==nil then bh=GetCompletedQuestInfo(b4)or""end;if LibUespQuestData:GetUespQuestName(b4)==a6 and not overrideName then b7=b4;ba=LibUespQuestData:GetUespQuestBackgroundText(b7)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b7)end;if b8==""then b8=nil end;break elseif bh==a6 then b7=b4;ba=LibUespQuestData:GetUespQuestBackgroundText(b7)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8=LibUespQuestData:GetUespQuestLocationInfo(b7)end;if b8==""then b8=nil end;if I==2 and a0==2 then end;break end end;if I==2 and a0==2 then end else ba=LibUespQuestData:GetUespQuestBackgroundText(b7)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b7)end;if b8==""then b8=nil end end;if type(aO)=="number"then a7=b8 or GetZoneNameById(aO)else a7=b8 end;if GetCompletedQuestInfo(b7)==""and not bb and not bc then a5=false;for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==a6 then a4=true;_,a7=GetJournalQuestInfo(k)break else a4=false end end;a8=""else a5=true;a4=true;a7=""a8=ba end;local function bk(bl,bm)if a6==LibUespQuestData:GetUespQuestName(bm)then bl=string.gsub(bl," u2026.","...")else bl=string.gsub(bl," u2026","...")end;return bl end;if ba~=""and ba then if a8==ba then a8=bk(a8,4296)a8=bk(a8,-1)a8=string.gsub(a8,"u2014","—")elseif a7==ba then a7=bk(a7,4296)a7=bk(a7,-1)a7=string.gsub(a7,"u2014","—")end end;local bn=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].overrideZone;if a7==nil or a7==""or bn then a7=bn;if a7==nil or a7==""then a7=GetString(TQG_DEFAULT_QUEST_INCOMPLETE_STRING)end end;if a8==nil or a8==""then a8=GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING)end;local bo=TQG.ObjectiveLevelClassic[I][a0][objectiveIndex].optional or false;return a6,a7,a8,ai,a4,a5,bo end;function TQG.Classic:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local a9={}for I=1,#TQG.TopLevelClassic do local aa=#TQG.ZoneLevelClassic[I]if self.currentProgressionLevel<I then break end;if aa>0 then local ab=self.navigationTree:AddNode("ZO_IconHeader",I)for ac=1,aa do local aO,zoneName,a1,a2=Z(I,ac)local bp=0;local ad=true;local ae={}local aI,aJ,bq,br;if type(aO)=="number"then aI,aJ,bq,br=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(aO,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)elseif type(aO)=="string"then aI,aJ,bq,br=0,0,0,0 end;local af=bq;local bs=false;if br>0 then af=af+1;bs=true end;if af==0 then af=#TQG.ObjectiveLevelClassic[I][ac]end;local bt=1;if af~=#TQG.ObjectiveLevelClassic[I][ac]then if TQG.ObjectiveLevelClassic[I][ac][0]then bt=0;local bf=TQG.ObjectiveLevelClassic[I][ac][0].prologueQIds;if bf and bf>1 then af=af+bf-1 end elseif TQG.ObjectiveLevelClassic[I][ac][af+1].overrideDetails then af=af+#TQG.ObjectiveLevelClassic[I][ac]-af end end;for objectiveIndex=bt,af do local a6,ag,ah,ai,aj,ak,bu;if objectiveIndex==af and bs==true then a6="TBC"ag,ah=GetErrorString(br)ai=objectiveIndex;aj=false;ak=false;bu=false else a6,ag,ah,ai,aj,ak,bu=b6(I,ac,objectiveIndex,aI)ad=ad and(ak or bu)if ak then bp=bp+1 end end;table.insert(ae,{name=a6,openingText=ag,closingText=ah,order=ai,discovered=aj,completed=ak})end;table.sort(ae,ZO_CadwellSort)table.insert(a9,{name=zoneName,description=a1,order=a2,completed=ad and bp>=1,objectives=ae,parent=ab})end end end;table.sort(a9,ZO_CadwellSort)for k=1,#a9 do local al=a9[k]local ab=al.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",al,ab)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.Classic:RefreshDetails()local self=TQG_ALMANAC_CLASSIC;self.objectiveLinePool:ReleaseAllObjects()local am=self.navigationTree:GetSelectedData()if not am or not am.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;self.titleText:SetText(zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,am.name))self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,am.description))local an;for k=1,#am.objectives do local ao=am.objectives[k]local ap=self.objectiveLinePool:AcquireObject()if ao.name=="TBC"then ap:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(ao.openingText)elseif ao.discovered and not ao.completed then ap:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))elseif not ao.discovered then ap:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))else ap:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(false)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.closingText))end;if not an then ap:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else ap:SetAnchor(TOPLEFT,an,BOTTOMLEFT,0,15)end;an=ap end end;function TQG.Classic:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabClassic_OnShown()TQG_ALMANAC_CLASSIC:OnShown()end;function TQG_TabClassic_Initialize(m)TQG_ALMANAC_CLASSIC=TQG.Classic:New(m)end;if not TQG then TQG={}end;TQG.DLC=ZO_Object:Subclass()TQG.sceneNameQuestGuideDLC="QuestGuideDLC"TQG.selectedDLCZoneId=nil;TQG.trackedDLCPrologueQuestId=nil;TQG.ConfirmContinueDLCToEndingQuests={mustChoose=false,title={text=GetString(TQG_CONFIRM_QUEST_TITLE)},mainText={text=GetString(TQG_CONFIRM_MAIN_TEXT)},buttons={[1]={keybind="DIALOG_PRIMARY",text=GetString(TQG_CONFIRM_QUEST_ZONE_STORY),callback=function()TQG:TrackNextActivity(TQG.selectedDLCZoneId,nil)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.DLC:UpdateStoryButtons()end},[2]={keybind="DIALOG_SECONDARY",text=GetString(TQG_CONFIRM_QUEST_POI),callback=function()TQG:TrackNextActivity(TQG.selectedDLCZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)ZONE_STORIES_KEYBOARD:BuildZonesList()TQG.DLC:UpdateStoryButtons()end}}}ZO_Dialogs_RegisterCustomDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY",TQG.ConfirmContinueDLCToEndingQuests)local function bv()local I=0;local a0=0;local aG=1;for k=1,#TQG.ZoneLevelDLC do while aG<=#TQG.ZoneLevelDLC[k]do if TQG.ZoneLevelDLC[k][aG].id==TQG.selectedDLCZoneId then I=k;a0=aG;break end;aG=aG+1 end;if I>0 then break else aG=1 end end;return I,a0 end;local function bw(I,a0)local aI,aJ;aI,aJ,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedDLCZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)local aK=aJ-aI>0;aI,aJ,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedDLCZoneId,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)local aL=aJ-aI==TQG.ZoneLevelDLC[I][a0].PreEndSideQuestCheck;return false,false end;local function bx(I,a0)local self=TQG_ALMANAC_DLC;local am=self.navigationTree:GetSelectedData()if not am or not am.objectives then return end;local aN;if TQG.ObjectiveLevelDLC[I][a0][0]then aN=TQG.ObjectiveLevelDLC[I][a0][0].prologueQIds else aN=nil end;if not aN then return false,false end;for k=1,aN do if am.objectives[k].discovered==false then return true,false,k-1 elseif am.objectives[k].completed==false then return true,true,k-1 end end;return false,false end;local b5=GetCVar("language.2")if b5~="de"and b5~="fr"then b5="en"end;local by="TQG_QuestsDLC"local bz={}local function bA()bz={[5935]={[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.5559,0.5307,0.012,questId=5935,heading=LibUespQuestData:GetUespQuestName(5935),text=TQG.DLCQuestIdToTooltip[5935]}},[TQG.MapIdToLangName[33]]={{0.465429,0.154768,0.05,questId=5935,heading=LibUespQuestData:GetUespQuestName(5935),text=TQG.DLCQuestIdToTooltip[5935]}}},[6023]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.567,0.918,0.012,questId=6023,heading=LibUespQuestData:GetUespQuestName(6023),text=TQG.DLCQuestIdToTooltip[6023],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.231,0.5038,0.05,questId=6023,heading=LibUespQuestData:GetUespQuestName(6023),text=TQG.DLCQuestIdToTooltip[6023],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.2746,0.7435,0.012,questId=6023,heading=LibUespQuestData:GetUespQuestName(6023),text=TQG.DLCQuestIdToTooltip[6023],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.479,0.3914,0.05,questId=6023,heading=LibUespQuestData:GetUespQuestName(6023),text=TQG.DLCQuestIdToTooltip[6023],allianceId=3}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.85845,0.330827,0.012,questId=6023,heading=LibUespQuestData:GetUespQuestName(6023),text=TQG.DLCQuestIdToTooltip[6023],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.491956,0.434811,0.05,questId=6023,heading=LibUespQuestData:GetUespQuestName(6023),text=TQG.DLCQuestIdToTooltip[6023],allianceId=2}}},[6097]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.567,0.918,0.012,questId=6097,heading=LibUespQuestData:GetUespQuestName(6097),text=TQG.DLCQuestIdToTooltip[6097],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.231,0.5038,0.05,questId=6097,heading=LibUespQuestData:GetUespQuestName(6097),text=TQG.DLCQuestIdToTooltip[6097],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.85845,0.330827,0.012,questId=6097,heading=LibUespQuestData:GetUespQuestName(6097),text=TQG.DLCQuestIdToTooltip[6097],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.491956,0.434811,0.05,questId=6097,heading=LibUespQuestData:GetUespQuestName(6097),text=TQG.DLCQuestIdToTooltip[6097],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.2746,0.7435,0.012,questId=6097,heading=LibUespQuestData:GetUespQuestName(6097),text=TQG.DLCQuestIdToTooltip[6097],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.479,0.3914,0.05,questId=6097,heading=LibUespQuestData:GetUespQuestName(6097),text=TQG.DLCQuestIdToTooltip[6097],allianceId=3}}},[6226]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5641,0.4696,0.012,questId=6226,heading=LibUespQuestData:GetUespQuestName(6226),text=TQG.DLCQuestIdToTooltip[6226],allianceId=1}},[TQG.MapIdToLangName[445]]={{0.49595,0.36798,0.05,questId=6226,heading=LibUespQuestData:GetUespQuestName(6226),text=TQG.DLCQuestIdToTooltip[6226],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.5688,0.5339,0.012,questId=6226,heading=LibUespQuestData:GetUespQuestName(6226),text=TQG.DLCQuestIdToTooltip[6226],allianceId=2}},[TQG.MapIdToLangName[205]]={{0.58299,0.76898,0.05,questId=6226,heading=LibUespQuestData:GetUespQuestName(6226),text=TQG.DLCQuestIdToTooltip[6226],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.545,0.534,0.012,questId=6226,heading=LibUespQuestData:GetUespQuestName(6226),text=TQG.DLCQuestIdToTooltip[6226],allianceId=3}},[TQG.MapIdToLangName[33]]={{0.4221,0.16459,0.05,questId=6226,heading=LibUespQuestData:GetUespQuestName(6226),text=TQG.DLCQuestIdToTooltip[6226],allianceId=3}}},[6242]={[GetMapNameByIndex(GetMapIndexByZoneId(117))]={{0.5076,0.2318,0.012,questId=6242,heading=LibUespQuestData:GetUespQuestName(6242),text=TQG.DLCQuestIdToTooltip[6242]}},[TQG.MapIdToLangName[217]]={{0.8422,0.2390,0.05,questId=6242,heading=LibUespQuestData:GetUespQuestName(6242),text=TQG.DLCQuestIdToTooltip[6242]}}},[6299]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.6411,0.8744,0.012,questId=6299,heading=LibUespQuestData:GetUespQuestName(6299),text=TQG.DLCQuestIdToTooltip[6299],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.5971,0.2883,0.05,questId=6299,heading=LibUespQuestData:GetUespQuestName(6299),text=TQG.DLCQuestIdToTooltip[6299],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.9120,0.3982,0.012,questId=6299,heading=LibUespQuestData:GetUespQuestName(6299),text=TQG.DLCQuestIdToTooltip[6299],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.7593,0.7710,0.05,questId=6299,heading=LibUespQuestData:GetUespQuestName(6299),text=TQG.DLCQuestIdToTooltip[6299],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.3422,0.7472,0.012,questId=6299,heading=LibUespQuestData:GetUespQuestName(6299),text=TQG.DLCQuestIdToTooltip[6299],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.8074,0.40887,0.05,questId=6299,heading=LibUespQuestData:GetUespQuestName(6299),text=TQG.DLCQuestIdToTooltip[6299],allianceId=3}}},[6306]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5942,0.1537,0.012,questId=6306,heading=LibUespQuestData:GetUespQuestName(6306),text=TQG.DLCQuestIdToTooltip[6306]}}},[6395]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.63695,0.93553,0.012,questId=6395,heading=LibUespQuestData:GetUespQuestName(6395),text=TQG.DLCQuestIdToTooltip[6395],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.5766,0.5903,0.05,questId=6395,heading=LibUespQuestData:GetUespQuestName(6395),text=TQG.DLCQuestIdToTooltip[6395],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.90468,0.38861,0.012,questId=6395,heading=LibUespQuestData:GetUespQuestName(6395),text=TQG.DLCQuestIdToTooltip[6395],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.7226,0.7231,0.05,questId=6395,heading=LibUespQuestData:GetUespQuestName(6395),text=TQG.DLCQuestIdToTooltip[6395],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.32298,0.80255,0.012,questId=6395,heading=LibUespQuestData:GetUespQuestName(6395),text=TQG.DLCQuestIdToTooltip[6395],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.7141,0.6731,0.05,questId=6395,heading=LibUespQuestData:GetUespQuestName(6395),text=TQG.DLCQuestIdToTooltip[6395],allianceId=3}}},[6398]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.63695,0.93553,0.012,questId=6398,heading=LibUespQuestData:GetUespQuestName(6398),text=TQG.DLCQuestIdToTooltip[6398],allianceId=1}},[TQG.MapIdToLangName[243]]={{0.5766,0.5903,0.05,questId=6398,heading=LibUespQuestData:GetUespQuestName(6398),text=TQG.DLCQuestIdToTooltip[6398],allianceId=1}},[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.90468,0.38861,0.012,questId=6398,heading=LibUespQuestData:GetUespQuestName(6398),text=TQG.DLCQuestIdToTooltip[6398],allianceId=2}},[TQG.MapIdToLangName[24]]={{0.7226,0.7231,0.05,questId=6398,heading=LibUespQuestData:GetUespQuestName(6398),text=TQG.DLCQuestIdToTooltip[6398],allianceId=2}},[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.32298,0.80255,0.012,questId=6398,heading=LibUespQuestData:GetUespQuestName(6398),text=TQG.DLCQuestIdToTooltip[6398],allianceId=3}},[TQG.MapIdToLangName[63]]={{0.7141,0.6731,0.05,questId=6398,heading=LibUespQuestData:GetUespQuestName(6398),text=TQG.DLCQuestIdToTooltip[6398],allianceId=3}}}}end;function TQG.DLC:SetupPins()bA()local function bB(bC)local bD=GetMapName()local b7=TQG.trackedDLCPrologueQuestId;if bz[b7]==nil then return end;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]for _,bF in ipairs(bE)do bC:CreatePin(_G[by],bF,bF[1],bF[2])end end;local bG=bB;local bH=nil;pinLayoutData={showsPinAndArea=true,level=10,minSize=100,texture="EsoUI/Art/MapPins/MapAutoNavigationPing.dds",isAnimated=true,framesWide=32,framesHigh=1,framesPerSecond=32}local bI={creator=function(bJ)local bK,at;local bD=GetMapName()local b7=TQG.trackedDLCPrologueQuestId;if bz[b7]==nil then return end;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]for _,bF in ipairs(bE)do if bF[4]==bJ.m_PinTag[4]then bK=bF.heading;at=bF.text;break end end;InformationTooltip:AddLine(bK,"ZoFontGameOutline",ZO_SELECTED_TEXT:UnpackRGB())ZO_Tooltip_AddDivider(InformationTooltip)InformationTooltip:AddLine(at,"",ZO_HIGHLIGHT_TEXT:UnpackRGB())end,tooltip=1}ZO_WorldMap_AddCustomPin(by,bG,bH,pinLayoutData,bI)ZO_WorldMap_SetCustomPinEnabled(_G[by],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[by])end;local function bL(bM,bN,bO,b8)local bD=GetMapName()local b7=TQG.trackedDLCPrologueQuestId;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]for _,bF in ipairs(bE)do if bO==LibUespQuestData:GetUespQuestName(bF.questId)or bO==bF.heading then ZO_WorldMap_SetCustomPinEnabled(_G[by],false)ZO_WorldMap_RefreshCustomPinsOfType(_G[by])EVENT_MANAGER:UnregisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED)break end end end;function TQG.DLC:PlayStory_OnClick()local I,a0;local aK,aL;local bP;I,a0=bv()if I<1 then return end;aK,aL=bw(I,a0)bP,prologueForDLCInProgress,objectiveIndex=bx(I,a0)if TQG.ZoneLevelDLC[I][a0].SideQuestCheck and aK and aL then ZO_Dialogs_ShowDialog("TQG_CONFIRM_CONTINUE_CLASSIC_ZONE_STORY")elseif bP and objectiveIndex then local b7=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].internalId;local by=by;local bQ=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].mapIndex;local bD=GetMapNameByIndex(bQ)TQG.trackedDLCPrologueQuestId=b7;if prologueForDLCInProgress then for k=1,GetNumJournalQuests()do local bO;if TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideQName then bO=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideQName elseif LibUespQuestData:GetUespQuestName(b7)then bO=LibUespQuestData:GetUespQuestName(b7)end;if GetJournalQuestName(k)==bO then local bR=k;ZO_WorldMap_ShowQuestOnMap(bR)return end end end;if bz[b7]==nil then return end;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]local bS,bT;for _,bF in ipairs(bE)do if bF.questId==b7 then bS=bF[1]bT=bF[2]break end end;ZO_WorldMap_SetCustomPinEnabled(_G[by],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[by])ZO_WorldMap_ShowWorldMap()zo_callLater(function()ZO_WorldMap_SetMapByIndex(bQ)end,1000)zo_callLater(function()ZO_WorldMap_PanToNormalizedPosition(bS,bT)end,1750)EVENT_MANAGER:RegisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED,bL)else TQG:TrackNextActivity(TQG.selectedDLCZoneId)ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateStoryButtons()end end;function TQG.DLC:StopTracking_OnClick()ClearTrackedZoneStory()ZONE_STORIES_KEYBOARD:BuildZonesList()self:UpdateStoryButtons()end;function TQG.DLC:OnQuestAcceptClicked(self)d(DLC_BOOK_KEYBOARD.navigationTree:GetSelectedData())end;function TQG.DLC:UpdateStoryButtons(S)local bU=false;if S then for k=1,#TQG.TopLevelDLC do for aG=1,#TQG.ZoneLevelDLC[k]do if TQG.ZoneLevelDLC[k][aG].name==S.name then TQG.selectedDLCZoneId=TQG.ZoneLevelDLC[k][aG].id;bU=TQG.ZoneLevelDLC[k][aG].isDungeonDLC;break end end end end;local aO=TQG.selectedDLCZoneId;local aX;local aY;if type(aO)=="string"then aX=false;aY=false else aX=ZO_ZoneStories_Manager.GetZoneAvailability(aO)aY=CanZoneStoryContinueTrackingActivities(aO)end;TQG.DLC.playStoryButton:SetEnabled(aX and aY)TQG.DLC.playStoryButton:SetText(TQG:GetPlayStoryButtonText(aO))TQG.DLC.playStoryButton:SetHidden(bU)local aZ=GetTrackedZoneStoryActivityInfo()TQG.DLC.stopTrackingButton:SetHidden(aZ~=aO)local bV;local bW;local bX;if type(aO)=="number"then bV=GetCollectibleIdForZone(GetZoneIndex(aO))bW=not IsCollectibleUnlocked(bV)bX=IsCollectibleActive(bV)else bV=0;bW=true;bX=false end;TQG.DLC.dungeonQuestAcceptButton:SetHidden(true)local bY=bX and SI_DLC_BOOK_ACTION_QUEST_ACCEPTED or SI_DLC_BOOK_ACTION_ACCEPT_QUEST;TQG.DLC.dungeonQuestAcceptButton:SetText(GetString(bY))TQG.DLC.dungeonQuestAcceptButton:SetEnabled(not(bW or bX))end;function TQG.DLC:StoryButtonHooks(a_)local b0=GetControl(a_)local b1=b0:GetNamedChild("ButtonContainer")TQG.DLC.playStoryButton=b1:GetNamedChild("PlayStoryButton")TQG.DLC.playStoryButton:SetClickSound(SOUNDS.ZONE_STORIES_TRACK_ACTIVITY)TQG.DLC.stopTrackingButton=b1:GetNamedChild("StopTrackingButton")TQG.DLC.dungeonQuestAcceptButton=b1:GetNamedChild("QuestAccept")end;function TQG.DLC:Initialize(m)local bZ=TQG.sceneNameQuestGuideDLC;TQG_DLC_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabDLC)TQG_SCENE_DLC=ZO_Scene:New(bZ,SCENE_MANAGER)TQG_SCENE_DLC:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_DLC:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_DLC:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_DLC:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_DLC:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_DLC:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_DLC:AddFragment(TITLE_FRAGMENT)TQG_SCENE_DLC:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_DLC:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_DLC:AddFragment(TQG_DLC_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(bZ,TQG_SCENE_DLC)TQG_SCENE_DLC:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=3;TQG.MenuHidden=false;TQGButtonsButton1.m_object:SetState(0)TQGButtonsButton1.m_object:SetLocked(false)TQGButtonsButton2.m_object:SetState(0)TQGButtonsButton2.m_object:SetLocked(false)TQGButtonsButton4.m_object:SetState(0)TQGButtonsButton4.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)TQG.DLC:StoryButtonHooks("TQG_TabDLC")end;function TQG.DLC:New(m)TQG.DLC:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabDLC_ObjectiveLine",m,"Objective")q.currentProgressionLevel=#TQG.TopLevelDLC;q:InitializeCategoryList(m)q:RefreshList()local function b3()q:RefreshList()end;local function b_(bM,c0,bN,bO,ac,b9,b7)q:RefreshList()end;local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_ADDED,b3)m:RegisterForEvent(EVENT_QUEST_REMOVED,b_)m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.DLC:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"esoui/art/treeicons/store_indexicon_dlc_down.dds","esoui\art/treeicons/store_indexicon_dlc_up.dds","esoui/art/treeicons/store_indexicon_dlc_over.dds"},[2]={"esoui/art/icons/progression_tabicon_daedricconjuration_down.dds","esoui\art/icons/progression_tabicon_daedricconjuration_up.dds","esoui/art/icons/progression_tabicon_daedricconjuration_over.dds"},[3]={"/esoui/art/treeicons/tutorial_idexicon_murkmire_down.dds","/esoui\art/treeicons/tutorial_idexicon_murkmire_up.dds","/esoui/art/treeicons/tutorial_idexicon_murkmire_over.dds"},[4]={"esoui/art/icons/progression_tabicon_dragonaspect_down.dds","esoui\art/icons/progression_tabicon_dragonaspect_up.dds","esoui/art/icons/progression_tabicon_dragonaspect_over.dds"},[5]={"esoui/art/icons/progression_tabicon_darkmagic_down.dds","esoui\art/icons/progression_tabicon_darkmagic_up.dds","esoui/art/icons/progression_tabicon_darkmagic_over.dds"},[6]={"esoui/art/icons/heraldrycrests_daedra_mehronesdagon_01.dds","esoui\art\icons\heraldrycrests_daedra_mehronesdagon_01.dds","esoui/art/icons/heraldrycrests_daedra_mehronesdagon_01.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelDLC[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,nil,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then TQG.DLC:UpdateStoryButtons(S)self:RefreshDetails()end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local a6=TQG.ZoneLevelDLC[I][a0].name;local b4=TQG.ZoneLevelDLC[I][a0].id;local a1=""if type(a6)=="number"or a6==""then a6=TQG.ZoneLevelDLC[I][a0].name;a6="("..string.format("%.2f",a6)..")"local b5=GetCVar("language.2")if b5~="de"and b5~="fr"then b5="en"end;if b5=="de"or b5=="fr"then a6=string.gsub(a6,"%.",",",1)end;zoneName=GetZoneNameById(b4)TQG.ZoneLevelDLC[I][a0].name=a6 .." "..zoneName end;local zoneName=TQG.ZoneLevelDLC[I][a0].name;if type(b4)=="string"then a1=b4 else a1=GetZoneDescriptionById(b4)end;local a2=a0;return b4,zoneName,a1,a2 end;local function b6(I,a0,objectiveIndex,aI)local b5=GetCVar("language.2")if b5~="de"and b5~="fr"and b5~="ru"then b5="en"end;local a5=false;local ai=objectiveIndex;local a6,a7,a8,a4;local b7,b8,b9,ba;local aO=TQG.ZoneLevelDLC[I][a0].id;local c1=false;if TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideDetails then local overrideName=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideQName or nil;b7=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].internalId;a6=GetCompletedQuestInfo(b7)if overrideName then a6=overrideName elseif a6==""then a6=LibUespQuestData:GetUespQuestName(b7)end else local bf=TQG.ObjectiveLevelDLC[I][a0][1].prologueQIds;if bf and objectiveIndex>=bf then ai=ai+bf-1;objectiveIndex=objectiveIndex-(bf-1)end;a6=GetZoneStoryActivityNameByActivityIndex(aO,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS,objectiveIndex)objectiveIndex=ai end;if not b7 then for k,c2 in ipairs(TQG.MultiQuestIds[2])do local bh=GetCompletedQuestInfo(c2)or""if bh==a6 then local b4=5602;b7=b4;ba=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideDescription;if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b4)end;if b8==""then b8=nil end;c1=true;break end end end;if not b7 then for k,bj in pairs(LibUespQuestData.quests)do local b4=tonumber(bj.internalId)local bh=""bh=GetCompletedQuestInfo(b4)if bh==""or bh==nil then bh=GetCompletedQuestInfo(b4)or""end;if LibUespQuestData:GetUespQuestName(b4)==a6 and not overrideName then b7=b4;ba=LibUespQuestData:GetUespQuestBackgroundText(b4)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b4)end;if b8==""then b8=nil end;break elseif bh==a6 then b7=b4;ba=LibUespQuestData:GetUespQuestBackgroundText(b4)local b8=""if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8=LibUespQuestData:GetUespQuestLocationInfo(b4)end;if b8==""then b8=nil end;break end end elseif not c1 then ba=LibUespQuestData:GetUespQuestBackgroundText(b7)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b7)end;if b8==""then b8=nil end end;if type(aO)=="number"then a7=b8 or GetZoneNameById(aO)else a7=b8 end;if GetCompletedQuestInfo(b7)==""and not c1 then a5=false;for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==a6 then a4=true;_,a7=GetJournalQuestInfo(k)break else a4=false end end;a8=""else a5=true;a4=true;a7=""a8=ba end;local function bk(bl,bm)if a6==LibUespQuestData:GetUespQuestName(bm)then bl=string.gsub(bl," u2026.","...")else bl=string.gsub(bl," u2026","...")end;return bl end;if ba~=""and ba then if a8==ba then a8=bk(a8,4296)a8=bk(a8,-1)a8=string.gsub(a8,"u2014","—")elseif a7==ba then a7=bk(a7,4296)a7=bk(a7,-1)a7=string.gsub(a7,"u2014","—")end end;local bn=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].overrideZone;if a7==nil or a7==""or bn then a7=bn;if a7==nil or a7==""then a7=GetString(TQG_DEFAULT_QUEST_INCOMPLETE_STRING)end end;if a8==nil or a8==""then a8=GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING)end;local bo=TQG.ObjectiveLevelDLC[I][a0][objectiveIndex].optional or false;return a6,a7,a8,ai,a4,a5,bo end;function TQG.DLC:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local a9={}for I=1,#TQG.TopLevelDLC do local aa=#TQG.ZoneLevelDLC[I]if self.currentProgressionLevel<I then break end;if aa>0 then local ab=self.navigationTree:AddNode("ZO_IconHeader",I)for ac=1,aa do local aO,zoneName,a1,a2=Z(I,ac)local bp=0;local ad=true;local ae={}local aI,aJ,bq,br;if type(aO)=="number"then aI,aJ,bq,br=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(aO,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)elseif type(aO)=="string"then aI,aJ,bq,br=0,0,0,0 end;local af=bq;local bs=false;if br>0 then af=af+1;bs=true end;if af==0 then af=#TQG.ObjectiveLevelDLC[I][ac]end;local bt=1;if af~=#TQG.ObjectiveLevelDLC[I][ac]then if TQG.ObjectiveLevelDLC[I][ac][0]then bt=0;local bf=TQG.ObjectiveLevelDLC[I][ac][0].prologueQIds;if bf and bf>1 then af=af+bf-1 end elseif TQG.ObjectiveLevelDLC[I][ac][af+1].overrideDetails then af=af+#TQG.ObjectiveLevelDLC[I][ac]-af end end;for objectiveIndex=bt,af do local a6,ag,ah,ai,aj,ak,bu;if objectiveIndex==af and bs==true then a6="TBC"ag,ah=GetErrorString(br)ai=objectiveIndex;aj=false;ak=false;bu=false else a6,ag,ah,ai,aj,ak,bu=b6(I,ac,objectiveIndex,aI)ad=ad and(ak or bu)if ak then bp=bp+1 end end;table.insert(ae,{name=a6,openingText=ag,closingText=ah,order=ai,discovered=aj,completed=ak})end;table.sort(ae,ZO_CadwellSort)table.insert(a9,{name=zoneName,description=a1,order=a2,completed=ad and bp>=1,objectives=ae,parent=ab})end end end;table.sort(a9,ZO_CadwellSort)for k=1,#a9 do local al=a9[k]local ab=al.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",al,ab)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.DLC:RefreshDetails()local self=TQG_ALMANAC_DLC;self.objectiveLinePool:ReleaseAllObjects()local am=self.navigationTree:GetSelectedData()if not am or not am.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;self.titleText:SetText(zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,am.name))self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,am.description))local an;for k=1,#am.objectives do local ao=am.objectives[k]local ap=self.objectiveLinePool:AcquireObject()if ao.name=="TBC"then ap:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(ao.openingText)elseif ao.discovered and not ao.completed then ap:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))elseif not ao.discovered then ap:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))else ap:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(false)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.closingText))end;if not an then ap:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else ap:SetAnchor(TOPLEFT,an,BOTTOMLEFT,0,15)end;an=ap end end;function TQG.DLC:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabDLC_OnShown()TQG_ALMANAC_DLC:OnShown()end;function TQG_TabDLC_Initialize(m)TQG_ALMANAC_DLC=TQG.DLC:New(m)end;if not TQG then TQG={}end;TQG.Group=ZO_Object:Subclass()TQG.sceneNameQuestGuideGroup="QuestGuideGroup"TQG.selectedGroupZoneId=nil;TQG.trackedGroupQuestId=nil;TQG.trackedGroupObjectiveIndex=nil;function TQG.ButtonSetup(m)local av="Click_MenuBar"local c3={categoryName=TQG.OverviewTabName,descriptor="The Questing Guide: Overview",normal="esoui/art/progression/progression_indexicon_world_up.dds",pressed="esoui/art/progression/progression_indexicon_world_down.dds",highlight="esoui/art/progression/progression_indexicon_world_over.dds",callback=function(c4)PlaySound(av)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideOverview)end}local c5={categoryName=TQG.ClassicTabName,descriptor="The Questing Guide: Classic",normal="esoui/art/campaign/campaignbrowser_indexicon_specialevents_up.dds",pressed="esoui/art/campaign/campaignbrowser_indexicon_specialevents_down.dds",highlight="esoui/art/campaign/campaignbrowser_indexicon_specialevents_over.dds",callback=function(c4)PlaySound(av)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideClassic)end}local c6={categoryName=TQG.DLCTabName,descriptor="The Questing Guide: DLC",normal="esoui/art/treeicons/store_indexicon_dlc_up.dds",pressed="esoui/art/treeicons/store_indexicon_dlc_down.dds",highlight="esoui/art/treeicons/store_indexicon_dlc_over.dds",callback=function(c4)PlaySound(av)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideDLC)end}local c7={categoryName=TQG.GroupTabName,descriptor="The Questing Guide: Group",normal="esoui/art/icons/achievements_indexicon_dungeons_up.dds",pressed="esoui/art/icons/achievements_indexicon_dungeons_down.dds",highlight="esoui/art/icons/achievements_indexicon_dungeons_over.dds",callback=function(c4)PlaySound(av)SCENE_MANAGER:Show(TQG.sceneNameQuestGuideGroup)end}local c8=CreateControlFromVirtual("TQGButtons",TQG_SharedRightBackground,"ZO_LabelButtonBar")c8:SetAnchor(TOPRIGHT,TQG_SharedRightBackground,TOPRIGHT,-450,1)local c9={buttonPadding=16,normalSize=51,downSize=64,animationDuration=DEFAULT_SCENE_TRANSITION_TIME,buttonTemplate="ZO_MenuBarTooltipButton"}ZO_MenuBar_SetData(c8,c9)local ca=ZO_MenuBar_AddButton(c8,c3)local cb=ZO_MenuBar_AddButton(c8,c5)local cc=ZO_MenuBar_AddButton(c8,c6)local cd=ZO_MenuBar_AddButton(c8,c7)end;local function ce()local I=0;local a0=0;local aG=1;for k=1,#TQG.ZoneLevelGroup do while aG<=#TQG.ZoneLevelGroup[k]do if TQG.ZoneLevelGroup[k][aG].id==TQG.selectedGroupZoneId then I=k;a0=aG;break end;aG=aG+1 end;if I>0 then break else aG=1 end end;return I,a0 end;local function cf(I,a0)local aI,aJ;aI,aJ,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedGroupZoneId,ZONE_COMPLETION_TYPE_POINTS_OF_INTEREST)local aK=aJ-aI>0;aI,aJ,_,_=ZO_ZoneStories_Manager.GetActivityCompletionProgressValuesAndText(TQG.selectedGroupZoneId,ZONE_COMPLETION_TYPE_PRIORITY_QUESTS)local aL=aJ-aI==TQG.ZoneLevelGroup[I][a0].PreEndSideQuestCheck;return false,false end;local function cg(I,a0)local self=TQG_ALMANAC_GROUP;local am=self.navigationTree:GetSelectedData()if not am or not am.objectives then return end;local ch=#TQG.ObjectiveLevelGroup[I][a0]if not ch then return false,false end;for k=1,ch do if am.objectives[k].discovered==false then return true,false elseif am.objectives[k].completed==false then return true,true end end;return false,false end;local b5=GetCVar("language.2")if b5~="de"and b5~="fr"then b5="en"end;local by="TQG_QuestsGroup"local bz={[4107]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.3161,0.1054,0.012,questId=4107,heading="",text=TQG.GroupQuestIdToTooltip[4107],allianceId=1}}},[4597]={[GetMapNameByIndex(GetMapIndexByZoneId(381))]={{0.3161,0.1054,0.012,questId=4597,heading="",text=TQG.GroupQuestIdToTooltip[4597],allianceId=1}}},[4336]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5268,0.4841,0.012,questId=4336,heading="",text=TQG.GroupQuestIdToTooltip[4336],allianceId=1}}},[4675]={[GetMapNameByIndex(GetMapIndexByZoneId(383))]={{0.5268,0.4841,0.012,questId=4675,heading="",text=TQG.GroupQuestIdToTooltip[4675],allianceId=1}}},[4778]={[GetMapNameByIndex(GetMapIndexByZoneId(108))]={{0.6585,0.3000,0.012,questId=4778,heading="",text=TQG.GroupQuestIdToTooltip[4778],allianceId=1}}},[5120]={[GetMapNameByIndex(GetMapIndexByZoneId(108))]={{0.6585,0.3000,0.012,questId=5120,heading="",text=TQG.GroupQuestIdToTooltip[5120],allianceId=1}}},[4538]={[GetMapNameByIndex(GetMapIndexByZoneId(58))]={{0.7142,0.3371,0.012,questId=4538,heading="",text=TQG.GroupQuestIdToTooltip[4538],allianceId=1}}},[4733]={[GetMapNameByIndex(GetMapIndexByZoneId(382))]={{0.2063,0.7974,0.012,questId=4733,heading="",text=TQG.GroupQuestIdToTooltip[4733],allianceId=1}}},[4054]={[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.7146,0.3372,0.012,questId=4054,heading="",text=TQG.GroupQuestIdToTooltip[4054],allianceId=1}}},[4555]={[GetMapNameByIndex(GetMapIndexByZoneId(3))]={{0.7146,0.3372,0.012,questId=4555,heading="",text=TQG.GroupQuestIdToTooltip[4555],allianceId=1}}},[4246]={[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.5620,0.5772,0.012,questId=4246,heading="",text=TQG.GroupQuestIdToTooltip[4246],allianceId=1}}},[4813]={[GetMapNameByIndex(GetMapIndexByZoneId(19))]={{0.5620,0.5772,0.012,questId=4813,heading="",text=TQG.GroupQuestIdToTooltip[4813],allianceId=1}}},[4379]={[GetMapNameByIndex(GetMapIndexByZoneId(20))]={{0.7222,0.7363,0.012,questId=4379,heading="",text=TQG.GroupQuestIdToTooltip[4379],allianceId=1}}},[5113]={[GetMapNameByIndex(GetMapIndexByZoneId(20))]={{0.7222,0.7363,0.012,questId=5113,heading="",text=TQG.GroupQuestIdToTooltip[5113],allianceId=1}}},[4432]={[GetMapNameByIndex(GetMapIndexByZoneId(104))]={{0.8733,0.4636,0.012,questId=4432,heading="",text=TQG.GroupQuestIdToTooltip[4432],allianceId=1}}},[4589]={[GetMapNameByIndex(GetMapIndexByZoneId(92))]={{0.3718,0.2773,0.012,questId=4589,heading="",text=TQG.GroupQuestIdToTooltip[4589],allianceId=1}}},[3993]={[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.0960,0.4483,0.012,questId=3993,heading="",text=TQG.GroupQuestIdToTooltip[3993],allianceId=1}}},[4303]={[GetMapNameByIndex(GetMapIndexByZoneId(41))]={{0.0960,0.4483,0.012,questId=4303,heading="",text=TQG.GroupQuestIdToTooltip[4303],allianceId=1}}},[4145]={[GetMapNameByIndex(GetMapIndexByZoneId(57))]={{0.7906,0.5859,0.012,questId=4145,heading="",text=TQG.GroupQuestIdToTooltip[4145],allianceId=1}}},[4641]={[GetMapNameByIndex(GetMapIndexByZoneId(57))]={{0.7906,0.5859,0.012,questId=4641,heading="",text=TQG.GroupQuestIdToTooltip[4641],allianceId=1}}},[4202]={[GetMapNameByIndex(GetMapIndexByZoneId(117))]={{0.1663,0.5852,0.012,questId=4202,heading="",text=TQG.GroupQuestIdToTooltip[4202],allianceId=1}}},[4346]={[GetMapNameByIndex(GetMapIndexByZoneId(101))]={{0.7367,0.7031,0.012,questId=4346,heading="",text=TQG.GroupQuestIdToTooltip[4346],allianceId=1}}},[4469]={[GetMapNameByIndex(GetMapIndexByZoneId(103))]={{0.8909,0.6468,0.012,questId=4469,heading="",text=TQG.GroupQuestIdToTooltip[4469],allianceId=1}}},[4822]={[GetMapNameByIndex(GetMapIndexByZoneId(347))]={{0.5793,0.4849,0.012,questId=4822,heading="",text=TQG.GroupQuestIdToTooltip[4822],allianceId=1}}},[5102]={[GetMapNameByIndex(GetMapIndexByZoneId(888))]={{0.8759,0.6057,0.012,questId=5102,heading="",text=TQG.GroupQuestIdToTooltip[5102],allianceId=1}}},[5087]={[GetMapNameByIndex(GetMapIndexByZoneId(888))]={{0.2375,0.6214,0.012,questId=5087,heading="",text=TQG.GroupQuestIdToTooltip[5087],allianceId=1}}},[5743]={[GetMapNameByIndex(GetMapIndexByZoneId(888))]={{0.3859,0.2602,0.012,questId=5743,heading="",text=TQG.GroupQuestIdToTooltip[5743],allianceId=1}}},[5136]={[GetMapNameByIndex(GetMapIndexByZoneId(181))]={{0.4979,0.3912,0.012,questId=5136,heading="",text=TQG.GroupQuestIdToTooltip[5136],allianceId=1}}},[5342]={[GetMapNameByIndex(GetMapIndexByZoneId(181))]={{0.4979,0.3912,0.012,questId=5342,heading="",text=TQG.GroupQuestIdToTooltip[5342],allianceId=1}}},[5448]={[GetMapNameByIndex(GetMapIndexByZoneId(684))]={{0.9305,0.3627,0.012,questId=5448,heading="",text=TQG.GroupQuestIdToTooltip[5448],allianceId=1}}},[5554]={[GetMapNameByIndex(GetMapIndexByZoneId(816))]={{0.6170,0.4737,0.012,questId=5554,heading="",text=TQG.GroupQuestIdToTooltip[5554],allianceId=1}}},[5352]={[GetMapNameByIndex(GetMapIndexByZoneId(382))]={{0.2259,0.7442,0.012,questId=5352,heading="",text=TQG.GroupQuestIdToTooltip[5352],allianceId=1}}},[6000]={[GetMapNameByIndex(GetMapIndexByZoneId(849))]={{0.4833,0.9006,0.012,questId=6000,heading="",text=TQG.GroupQuestIdToTooltip[6000],allianceId=1}}},[5894]={[GetMapNameByIndex(GetMapIndexByZoneId(849))]={{0.7686,0.5844,0.012,questId=5894,heading="",text=TQG.GroupQuestIdToTooltip[5894],allianceId=1}}},[6090]={[GetMapNameByIndex(GetMapIndexByZoneId(980))]={{0.3634,0.3471,0.012,questId=6090,heading="",text=TQG.GroupQuestIdToTooltip[6090],allianceId=1}}},[6193]={[GetMapNameByIndex(GetMapIndexByZoneId(1011))]={{0.2729,0.6150,0.012,questId=6193,heading="",text=TQG.GroupQuestIdToTooltip[6193],allianceId=1}}},[6192]={[GetMapNameByIndex(GetMapIndexByZoneId(1011))]={{0.4228,0.3593,0.012,questId=6192,heading="",text=TQG.GroupQuestIdToTooltip[6192],allianceId=1}}},[6269]={[GetMapNameByIndex(GetMapIndexByZoneId(726))]={{0.3092,0.5398,0.012,questId=6269,heading="",text=TQG.GroupQuestIdToTooltip[6269],allianceId=1}}},[6354]={[GetMapNameByIndex(GetMapIndexByZoneId(1086))]={{0.7781,0.3152,0.012,questId=6354,heading="",text=TQG.GroupQuestIdToTooltip[6354],allianceId=1}}},[6353]={[GetMapNameByIndex(GetMapIndexByZoneId(1086))]={{0.3426,0.7417,0.012,questId=6353,heading="",text=TQG.GroupQuestIdToTooltip[6353],allianceId=1}}},[6504]={[GetMapNameByIndex(GetMapIndexByZoneId(1160))]={{0.5375,0.4224,0.012,questId=6504,heading="",text=TQG.GroupQuestIdToTooltip[6504],allianceId=1}}},[6503]={[GetMapNameByIndex(GetMapIndexByZoneId(1160))]={{0.4303,0.2448,0.012,questId=6503,heading="",text=TQG.GroupQuestIdToTooltip[6503],allianceId=1}}},[6597]={[GetMapNameByIndex(GetMapIndexByZoneId(1207))]={{0.3118,0.5128,0.012,questId=6597,heading="",text=TQG.GroupQuestIdToTooltip[6597],allianceId=1}}},[6610]={[GetMapNameByIndex(GetMapIndexByZoneId(1227))]={{0.4730,0.7487,0.012,questId=6610,heading="",text=TQG.GroupQuestIdToTooltip[6610],allianceId=1}}},[0]={[GetMapNameByIndex(GetMapIndexByZoneId(0))]={{0.0000,0.0000,0.012,questId=0,heading="",text=TQG.GroupQuestIdToTooltip[0],allianceId=1}}}}function TQG.Group:SetupPins()local function bB(bC)local bD=GetMapName()local b7=TQG.trackedGroupQuestId;if bz[b7]==nil then return end;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]for _,bF in ipairs(bE)do bC:CreatePin(_G[by],bF,bF[1],bF[2])end end;local bG=bB;local bH=nil;pinLayoutData={showsPinAndArea=true,level=10,minSize=100,texture="EsoUI/Art/MapPins/MapAutoNavigationPing.dds",isAnimated=true,framesWide=32,framesHigh=1,framesPerSecond=32}local bI={creator=function(bJ)local bK,at;local bD=GetMapName()local b7=TQG.trackedGroupQuestId;if bz[b7]==nil then return end;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]for _,bF in ipairs(bE)do if bF[4]==bJ.m_PinTag[4]then bK=LibUespQuestData:GetUespQuestName(bF.questId)at=bF.text;break end end;InformationTooltip:AddLine(bK,"ZoFontGameOutline",ZO_SELECTED_TEXT:UnpackRGB())ZO_Tooltip_AddDivider(InformationTooltip)InformationTooltip:AddLine(at,"",ZO_HIGHLIGHT_TEXT:UnpackRGB())end,tooltip=1}ZO_WorldMap_AddCustomPin(by,bG,bH,pinLayoutData,bI)ZO_WorldMap_SetCustomPinEnabled(_G[by],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[by])end;local function bL(bM,bN,bO,b8)local bD=GetMapName()local b7=TQG.trackedGroupQuestId;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]for _,bF in ipairs(bE)do if bO==LibUespQuestData:GetUespQuestName(bF.questId)or bO==bF.heading then ZO_WorldMap_SetCustomPinEnabled(_G[by],false)ZO_WorldMap_RefreshCustomPinsOfType(_G[by])EVENT_MANAGER:UnregisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED)break end end end;function TQG.Group:PlayStory_OnClick()local I,a0,objectiveIndex;I,a0=ce()objectiveIndex=TQG.trackedGroupObjectiveIndex;if I<1 then return end;questForGroupIncomplete,questForGroupInProgress=cg(I,a0)if objectiveIndex then local b7=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].internalId;local by=by;local bQ=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].mapIndex;local bD=GetMapNameByIndex(bQ)TQG.trackedGroupQuestId=b7;if questForGroupInProgress then for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==LibUespQuestData:GetUespQuestName(b7)then local bR=k;ZO_WorldMap_ShowQuestOnMap(bR)return end end end;if bz[b7][bD]==nil then return end;local bE=bz[b7][bD]local bS,bT;for _,bF in ipairs(bE)do if bF.questId==b7 then bS=bF[1]bT=bF[2]break end end;ZO_WorldMap_SetCustomPinEnabled(_G[by],true)ZO_WorldMap_RefreshCustomPinsOfType(_G[by])ZO_WorldMap_ShowWorldMap()zo_callLater(function()ZO_WorldMap_SetMapByIndex(bQ)end,1000)zo_callLater(function()ZO_WorldMap_PanToNormalizedPosition(bS,bT)end,1750)EVENT_MANAGER:RegisterForEvent("TheQuestingGuide",EVENT_QUEST_ADDED,bL)end end;function TQG.Group:UpdateStoryButtons(S)TQG.Group.dungeonQuestAcceptButton:SetEnabled(false)TQG.Group.dungeonQuestAcceptButton:SetHidden(true)local I,a0;if S then for k=1,#TQG.TopLevelGroup do for aG=1,#TQG.ZoneLevelGroup[k]do local _,ci=S.name:find(".dds",8,false)local cj=ci+4;if TQG.ZoneLevelGroup[k][aG].zoneName==S.name:sub(cj)then I=k;a0=aG;TQG.selectedGroupZoneId=TQG.ZoneLevelGroup[k][aG].id;break end end end end;if not I or not a0 then TQG.Group.playStoryButton:SetEnabled(false)TQG.Group.playStoryButton:SetText("")TQG.Group.playStoryButton:SetHidden(false)return end;for k=1,#TQG.ObjectiveLevelGroup[I][a0]do local b7=TQG.ObjectiveLevelGroup[I][a0][k].internalId;if GetCompletedQuestInfo(b7)~=""and GetCompletedQuestInfo(b7)~=nil then TQG.Group.playStoryButton:SetEnabled(false)TQG.Group.playStoryButton:SetText(GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING))TQG.Group.playStoryButton:SetHidden(false)TQG.trackedGroupObjectiveIndex=k else TQG.Group.playStoryButton:SetEnabled(true)TQG.Group.playStoryButton:SetText("Show Quest")TQG.Group.playStoryButton:SetHidden(false)TQG.trackedGroupObjectiveIndex=k;break end end end;function TQG.Group:StoryButtonHooks(a_)local b0=GetControl(a_)local b1=b0:GetNamedChild("ButtonContainer")TQG.Group.playStoryButton=b1:GetNamedChild("PlayStoryButton")TQG.Group.playStoryButton:SetClickSound(SOUNDS.ZONE_STORIES_TRACK_ACTIVITY)TQG.Group.dungeonQuestAcceptButton=b1:GetNamedChild("QuestAccept")end;function TQG.Group:Initialize(m)local ck=TQG.sceneNameQuestGuideGroup;TQG_GROUP_ALMANAC_FRAGMENT=ZO_HUDFadeSceneFragment:New(TQG_TabGroup)TQG_SCENE_GROUP=ZO_Scene:New(ck,SCENE_MANAGER)TQG_SCENE_GROUP:AddFragmentGroup(FRAGMENT_GROUP.MOUSE_DRIVEN_UI_WINDOW)TQG_SCENE_GROUP:AddFragmentGroup(FRAGMENT_GROUP.FRAME_TARGET_STANDARD_RIGHT_PANEL)TQG_SCENE_GROUP:AddFragmentGroup(FRAGMENT_GROUP.PLAYER_PROGRESS_BAR_KEYBOARD_CURRENT)TQG_SCENE_GROUP:AddFragment(FRAME_EMOTE_FRAGMENT_JOURNAL)TQG_SCENE_GROUP:AddFragment(TQG.BACKGROUND_FRAGMENT)TQG_SCENE_GROUP:AddFragment(TREE_UNDERLAY_FRAGMENT)TQG_SCENE_GROUP:AddFragment(TITLE_FRAGMENT)TQG_SCENE_GROUP:AddFragment(ZO_SetTitleFragment:New(SI_TQG_MENU_JOURNAL))TQG_SCENE_GROUP:AddFragment(CODEX_WINDOW_SOUNDS)TQG_SCENE_GROUP:AddFragment(TQG_GROUP_ALMANAC_FRAGMENT)SYSTEMS:RegisterKeyboardRootScene(ck,TQG_SCENE_GROUP)TQG_SCENE_GROUP:RegisterCallback("StateChange",function(o,p)if p==SCENE_SHOWING then TQG.MenuState=4;TQG.MenuHidden=false;TQGButtonsButton1.m_object:SetState(0)TQGButtonsButton1.m_object:SetLocked(false)TQGButtonsButton2.m_object:SetState(0)TQGButtonsButton2.m_object:SetLocked(false)TQGButtonsButton3.m_object:SetState(0)TQGButtonsButton3.m_object:SetLocked(false)elseif p==SCENE_HIDING then TQG.MenuHidden=true end end)TQG.ButtonSetup(m)TQG.Group:StoryButtonHooks("TQG_TabGroup")end;function TQG.Group:New(m)TQG.Group:Initialize(m)local q=ZO_Object.New(self)q.control=m;q.zoneInfoContainer=m:GetNamedChild("ZoneInfoContainer")q.zoneStepContainer=m:GetNamedChild("ZoneStepContainer")q.titleText=m:GetNamedChild("TitleText")q.descriptionText=m:GetNamedChild("DescriptionText")q.objectivesText=m:GetNamedChild("ObjectivesText")q.objectiveLinePool=ZO_ControlPool:New("TQG_TabGroup_ObjectiveLine",m,"Objective")q.currentProgressionLevel=#TQG.TopLevelGroup;q:InitializeCategoryList(m)q:RefreshList()local function b3()q:RefreshList()end;local function b_()q:RefreshList()end;local function F()q:RefreshList()end;m:RegisterForEvent(EVENT_QUEST_ADDED,b3)m:RegisterForEvent(EVENT_QUEST_REMOVED,b_)m:RegisterForEvent(EVENT_QUEST_COMPLETE,F)return q end;function TQG.Group:InitializeCategoryList(m)self.navigationTree=ZO_Tree:New(m:GetNamedChild("NavigationContainerScrollChild"),60,-10,300)local G={[1]={"/esoui/art/charactercreate/charactercreate_aldmeriicon_down.dds","/esoui\art/charactercreate/charactercreate_aldmeriicon_up.dds","/esoui/art/charactercreate/charactercreate_aldmeriicon_over.dds"},[2]={"/esoui/art/charactercreate/charactercreate_daggerfallicon_down.dds","/esoui\art/charactercreate/charactercreate_daggerfallicon_up.dds","/esoui/art/charactercreate/charactercreate_daggerfallicon_over.dds"},[3]={"/esoui/art/charactercreate/charactercreate_ebonhearticon_down.dds","/esoui\art/charactercreate/charactercreate_ebonhearticon_up.dds","/esoui/art/charactercreate/charactercreate_ebonhearticon_over.dds"},[4]={"esoui/art/treeicons/antiquities_tabicon_coldharbour_down.dds","esoui\art/treeicons/antiquities_tabicon_coldharbour_up.dds","esoui/art/treeicons/antiquities_tabicon_coldharbour_over.dds"},[5]={"esoui/art/treeicons/antiquities_tabicon_craglorn_down.dds","esoui\art/treeicons/antiquities_tabicon_craglorn_up.dds","esoui/art/treeicons/antiquities_tabicon_craglorn_over.dds"},[6]={"esoui/art/treeicons/store_indexicon_dlc_down.dds","esoui\art/treeicons/store_indexicon_dlc_up.dds","esoui/art/treeicons/store_indexicon_dlc_over.dds"},[7]={"esoui/art/icons/progression_tabicon_daedricconjuration_down.dds","esoui\art/icons/progression_tabicon_daedricconjuration_up.dds","esoui/art/icons/progression_tabicon_daedricconjuration_over.dds"},[8]={"/esoui/art/treeicons/tutorial_idexicon_murkmire_down.dds","/esoui\art/treeicons/tutorial_idexicon_murkmire_up.dds","/esoui/art/treeicons/tutorial_idexicon_murkmire_over.dds"},[9]={"esoui/art/icons/progression_tabicon_dragonaspect_down.dds","esoui\art/icons/progression_tabicon_dragonaspect_up.dds","esoui/art/icons/progression_tabicon_dragonaspect_over.dds"},[10]={"esoui/art/icons/progression_tabicon_darkmagic_down.dds","esoui\art/icons/progression_tabicon_darkmagic_up.dds","esoui/art/icons/progression_tabicon_darkmagic_over.dds"}}local function H(I)if G[I]then return unpack(G[I])end end;local function N(K,m,I,L)m.progressionLevel=I;m.text:SetModifyTextType(MODIFY_TEXT_TYPE_UPPERCASE)m.text:SetText(TQG.TopLevelGroup[I])local O,P,Q=H(I)m.icon:SetTexture(L and O or P)m.iconHighlight:SetTexture(Q)ZO_IconHeader_Setup(m,L)end;self.navigationTree:AddTemplate("ZO_IconHeader",N,nil,nil,nil,0)local function R(K,m,S,L)m:SetText(zo_strformat(SI_CADWELL_QUEST_NAME_FORMAT,S.name))GetControl(m,"CompletedIcon"):SetHidden(not S.completed)m:SetSelected(false)end;local function T(m,S,U,V)m:SetSelected(U)if U and not V then TQG.Group:UpdateStoryButtons(S)self:RefreshDetails()end end;local function W(X,Y)return X.name==Y.name end;self.navigationTree:AddTemplate("ZO_CadwellNavigationEntry",R,T,W)self.navigationTree:SetExclusive(true)self.navigationTree:SetOpenAnimation("ZO_TreeOpenAnimation")end;local function Z(I,a0)local a6=TQG.ZoneLevelGroup[I][a0].name;local b4=TQG.ZoneLevelGroup[I][a0].id;local a1=""if type(a6)=="number"or a6==""then a6=TQG.ZoneLevelGroup[I][a0].name;a6="("..string.format("%.2f",a6)..")"local b5=GetCVar("language.2")if b5~="de"and b5~="fr"then b5="en"end;if b5=="de"or b5=="fr"then a6=string.gsub(a6,"%.",",",1)end;zoneTemp=TQG.ZoneLevelGroup[I][a0].zoneName;zoneName=zoneTemp or GetZoneNameById(b4)local cl=TQG.ZoneLevelGroup[I][a0].type;if cl=="Dungeon"or cl=="Arena"then zoneName=string.format("%s |t32:32:%s|t %s",a6,"/esoui/art/icons/poi/poi_groupinstance_complete.dds",zoneName)elseif cl=="Trial"or cl=="Maelstrom Arena"then zoneName=string.format("%s |t32:32:%s|t %s",a6,"/esoui/art/icons/poi/poi_raiddungeon_complete.dds",zoneName)end;TQG.ZoneLevelGroup[I][a0].name=zoneName end;local zoneName=TQG.ZoneLevelGroup[I][a0].name;if type(b4)=="string"then a1=b4 else a1=GetZoneDescriptionById(b4)end;local a2=a0;return b4,zoneName,a1,a2 end;local function b6(I,a0,objectiveIndex,aI)local b5=GetCVar("language.2")if b5~="de"and b5~="fr"and b5~="ru"then b5="en"end;local a5=false;local ai=objectiveIndex;local a6,a7,a8,a4;local b7,b8,b9,ba;local aO=TQG.ZoneLevelGroup[I][a0].id;local cm=false;local overrideName=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].overrideQName or nil;b7=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].internalId;a6=GetCompletedQuestInfo(b7)if overrideName then a6=overrideName elseif a6==""then a6=LibUespQuestData:GetUespQuestName(b7)end;if b7==5743 then for k,cn in ipairs(TQG.MultiQuestIds[11])do local co,cp;if b5=="fr"then co="Le fantôme aîné"cp="L'aîné des fantômes"end;local bh=GetCompletedQuestInfo(cn)or""if bh==a6 or bh==co or bh==langTwo then local b4=cn;b7=b4;ba=LibUespQuestData:GetUespQuestBackgroundText(b4)cm=true;break end end end;if not b7 then for k,bj in pairs(LibUespQuestData.quests)do local b4=tonumber(bj.internalId)local bh=""bh=GetCompletedQuestInfo(b4)if bh==""or bh==nil then bh=GetCompletedQuestInfo(b4)or""end;if LibUespQuestData:GetUespQuestName(b4)==a6 and not overrideName then b7=b4;ba=LibUespQuestData:GetUespQuestBackgroundText(b4)_,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b4)if b8==""then b8=nil end;break elseif bh==a6 then b7=b4;ba=LibUespQuestData:GetUespQuestBackgroundText(b4)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8=LibUespQuestData:GetUespQuestLocationInfo(b4)end;if b8==""then b8=nil end;break end end elseif not cm then ba=LibUespQuestData:GetUespQuestBackgroundText(b7)if TQG.POIData[b7]then b8=GetPOIInfo(TQG.POIData[b7].zoneIndex,TQG.POIData[b7].poiIndex)else _,b8,b9=LibUespQuestData:GetUespQuestLocationInfo(b7)end;if b8==""then b8=nil end end;if type(aO)=="string"then local cq,_=aO:find(":",1,true)a7=b8 or aO:sub(1,cq-1)else a7=nil end;if GetCompletedQuestInfo(b7)==""and not cm then a5=false;for k=1,GetNumJournalQuests()do if GetJournalQuestName(k)==a6 then a4=true;_,a7=GetJournalQuestInfo(k)break else a4=false end end;a8=""else a5=true;a4=true;a7=""a8=ba end;local function bk(bl,bm)if a6==LibUespQuestData:GetUespQuestName(bm)then bl=string.gsub(bl," u2026.","...")else bl=string.gsub(bl," u2026","...")end;return bl end;if ba~=""and ba then if a8==ba then a8=bk(a8,4296)a8=bk(a8,-1)a8=string.gsub(a8,"u2014","—")elseif a7==ba then a7=bk(a7,4296)a7=bk(a7,-1)a7=string.gsub(a7,"u2014","—")end end;local bn=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].overrideZone;if a7==nil or a7==""or bn then a7=bn;if a7==nil or a7==""then a7=GetString(TQG_DEFAULT_QUEST_INCOMPLETE_STRING)end end;if a8==nil or a8==""then a8=GetString(TQG_DEFAULT_QUEST_COMPLETE_STRING)end;local bo=TQG.ObjectiveLevelGroup[I][a0][objectiveIndex].optional or false;return a6,a7,a8,ai,a4,a5,bo end;function TQG.Group:RefreshList()if self.control:IsHidden()then self.dirty=true;return end;self.navigationTree:Reset()local a9={}for I=1,#TQG.TopLevelGroup do local aa=#TQG.ZoneLevelGroup[I]if self.currentProgressionLevel<I then break end;if aa>0 then local ab=self.navigationTree:AddNode("ZO_IconHeader",I)for ac=1,aa do local aO,zoneName,a1,a2=Z(I,ac)local bp=0;local ad=true;local ae={}local aI,aJ,bq,br;aI,aJ,bq,br=0,0,0,0;local af=bq;local bs=false;if br>0 then af=af+1;bs=true end;if af==0 then af=#TQG.ObjectiveLevelGroup[I][ac]end;local bt=1;if af~=#TQG.ObjectiveLevelGroup[I][ac]then if TQG.ObjectiveLevelGroup[I][ac][0]then bt=0;local bf=TQG.ObjectiveLevelGroup[I][ac][0].prologueQIds;if bf and bf>1 then af=af+bf-1 end elseif TQG.ObjectiveLevelGroup[I][ac][af+1].overrideDetails then af=af+#TQG.ObjectiveLevelGroup[I][ac]-af end end;for objectiveIndex=bt,af do local a6,ag,ah,ai,aj,ak,bu;if objectiveIndex==af and bs==true then a6="TBC"ag,ah=GetErrorString(br)ai=objectiveIndex;aj=false;ak=false;bu=false else a6,ag,ah,ai,aj,ak,bu=b6(I,ac,objectiveIndex,aI)ad=ad and(ak or bu)if ak then bp=bp+1 end end;table.insert(ae,{name=a6,openingText=ag,closingText=ah,order=ai,discovered=aj,completed=ak})end;table.sort(ae,ZO_CadwellSort)table.insert(a9,{name=zoneName,description=a1,order=a2,completed=ad and bp>=1,objectives=ae,parent=ab})end end end;table.sort(a9,ZO_CadwellSort)for k=1,#a9 do local al=a9[k]local ab=al.parent;self.navigationTree:AddNode("ZO_CadwellNavigationEntry",al,ab)end;self.navigationTree:Commit()self:RefreshDetails()end;function TQG.Group:RefreshDetails()local self=TQG_ALMANAC_GROUP;self.objectiveLinePool:ReleaseAllObjects()local am=self.navigationTree:GetSelectedData()if not am or not am.objectives then self.zoneInfoContainer:SetHidden(true)self.zoneStepContainer:SetHidden(true)return else self.zoneInfoContainer:SetHidden(false)self.zoneStepContainer:SetHidden(false)end;local cr=zo_strformat(SI_CADWELL_ZONE_NAME_FORMAT,am.name)self.titleText:SetText(cr)self.descriptionText:SetText(zo_strformat(SI_CADWELL_ZONE_DESC_FORMAT,am.description))local an;for k=1,#am.objectives do local ao=am.objectives[k]local ap=self.objectiveLinePool:AcquireObject()if ao.name=="TBC"then ap:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(ao.openingText)elseif ao.discovered and not ao.completed then ap:SetColor(ZO_SELECTED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))elseif not ao.discovered then ap:SetColor(ZO_DISABLED_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(true)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.openingText))else ap:SetColor(ZO_NORMAL_TEXT:UnpackRGBA())GetControl(ap,"Check"):SetHidden(false)ap:SetText(zo_strformat(SI_CADWELL_OBJECTIVE_FORMAT,ao.name,ao.closingText))end;if not an then ap:SetAnchor(TOPLEFT,self.objectivesText,BOTTOMLEFT,25,15)else ap:SetAnchor(TOPLEFT,an,BOTTOMLEFT,0,15)end;an=ap end end;function TQG.Group:OnShown()if self.dirty then self:RefreshList()self.dirty=false end end;function TQG_TabGroup_OnShown()TQG_ALMANAC_GROUP:OnShown()end;function TQG_TabGroup_Initialize(m)TQG_ALMANAC_GROUP=TQG.Group:New(m)end